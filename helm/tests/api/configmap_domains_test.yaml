suite: Management API configMap - domains section
templates:
  - "api/api-configmap.yaml"
tests:
  - it: should paste in the domain reporters' config
    template: api/api-configmap.yaml
    set:
      domains:
        reporters: true
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - notMatchRegex:
          path: data["gravitee.yml"]
          pattern: |
            domains:
              reporters:
                default: true
  - it: should leave reporters config blank if not provided
    template: api/api-configmap.yaml
    set:
      domains:
        reporters: ""
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - notMatchRegex:
          path: data["gravitee.yml"]
          pattern: |
            domains:
              reporters:
                default: .+
  - it: should paste in the domain identities' config
    template: api/api-configmap.yaml
    set:
      domains:
        identities: true
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - notMatchRegex:
          path: data["gravitee.yml"]
          pattern: |
            domains:
              identities:
                default: true
  - it: should leave identities config blank if not provided
    template: api/api-configmap.yaml
    set:
      domains:
        identities: ""
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - notMatchRegex:
          path: data["gravitee.yml"]
          pattern: |
            domains:
              identities:
                default: .+
  - it: should copy secret providers settings
    template: api/api-configmap.yaml
    set:
      domains:
        secrets:
          providers:
            - id: test-id
              name: test-name
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ConfigMap
      - matchRegex:
          path: data["gravitee.yml"]
          pattern: "domains:\\n[\\s\\S]*\\s*secrets:\\n\\s*providers:\\n\\s*-\\s*id:\\s*test-id\\n\\s*name:\\s*test-name"
