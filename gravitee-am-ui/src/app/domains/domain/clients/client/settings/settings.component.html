<!--

    Copyright (C) 2015 The Gravitee team (http://gravitee.io)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<form (keydown.enter)="false" (ngSubmit)="update()" #clientForm="ngForm" fxLayout="column">
  <div fxLayout="row">
    <md-input-container fxFlex style="margin-right: 20px;">
      <input mdInput type="text" placeholder="Client ID" name="clientId" [(ngModel)]="client.clientId" disabled>
    </md-input-container>

    <md-input-container fxFlex>
      <input mdInput type="text" placeholder="Client Secret" name="clientSecret" [(ngModel)]="client.clientSecret" disabled>
    </md-input-container>

    <md-slide-toggle mdTooltip="{{client.enabled ? 'Disable client ?' : 'Enable client ?'}}" [mdTooltipPosition]="'before'"
      (change)="enableClient($event)"
      [checked]="client.enabled"></md-slide-toggle>
  </div>

  <h4>Auto approval</h4>
  <md-slide-toggle
    (change)="enableAutoApprove($event)"
    [checked]="isAutoApprove()">
  </md-slide-toggle>
  <md-hint><small class="hint">Allow to skip user approval. Generally used for internal trusted service applications.</small></md-hint>

  <h4>Identity providers</h4>
  <md-select placeholder="Identity providers" multiple name="identities" [(ngModel)]="client.identities">
    <md-option *ngFor="let identityProvider of identityProviders" [value]="identityProvider.id">{{ identityProvider.name }}</md-option>
  </md-select>

  <h4>Grant types</h4>
  <md-checkbox *ngFor="let grantType of grantTypes"
               name="grantTypes"
               value="{{grantType.value}}"
               [checked]="grantType.checked"
               (change)="selectedGrantType($event)">
    {{grantType.name}}
  </md-checkbox>

  <h4>Redirect URIs</h4>
  <md-input-container fxFlex>
    <input mdInput #inputRedirectURI (keyup.enter)="addRedirectURI($event, inputRedirectURI)" placeholder="New redirect URI..."/>
  </md-input-container>
  <md-chip-list class="mat-chip-list-stacked">
    <md-chip *ngFor="let redirectURI of client.redirectUris" color="accent" selected="true" fxLayout="row">
      <span fxFlex style="margin-top: 3px;">{{redirectURI}}</span>
      <md-icon class="delete-chip" (click)="removeRedirectURI(redirectURI, $event)">clear</md-icon>
    </md-chip>
  </md-chip-list>

  <h4 style="margin-bottom: 0px;">Scopes</h4>
  <md-chip-list style="margin-top: 10px; margin-bottom: 10px;">
    <md-chip *ngFor="let scope of client.scopes" color="accent" selected="true">
      <span>{{scope}}</span>
      <md-icon class="delete-chip" (click)="removeScope(scope, $event)">clear</md-icon>
    </md-chip>
  </md-chip-list>
  <md-input-container fxFlex>
    <input mdInput #inputScope (keyup.enter)="addScope(inputScope, $event)" placeholder="New scope..."/>
  </md-input-container>

  <h4>Tokens</h4>
  <div fxLayout="row">
    <md-input-container fxFlex style="margin-right: 20px;">
      <md-icon mdPrefix>timer</md-icon>
      <input mdInput type="number" placeholder="Access token validity" name="accessTokenValidity" [(ngModel)]="client.accessTokenValiditySeconds" />
      <span mdSuffix>seconds</span>
    </md-input-container>
    <md-input-container fxFlex>
      <md-icon mdPrefix>timer</md-icon>
      <input mdInput type="number" placeholder="Refresh token validity" name="refreshTokenValidity" [(ngModel)]="client.refreshTokenValiditySeconds" />
      <span mdSuffix>seconds</span>
    </md-input-container>
  </div>

  <h4>Certificate</h4>
  <md-select placeholder="Certificate" name="certificate" [(ngModel)]="client.certificate">
    <md-option *ngFor="let certificate of certificates" [value]="certificate.id">{{ certificate.name }}</md-option>
  </md-select>
  <div fxLayout="row" fxLayoutAlign="end end">
    <md-hint><small class="hint">Certificate use to sign tokens.</small></md-hint>
  </div>

  <div fxLayout="row" style="margin-top: 20px;">
    <button md-raised-button [disabled]="(!clientForm.valid || clientForm.pristine) && !formChanged" type="submit">SAVE</button>
  </div>
</form>
