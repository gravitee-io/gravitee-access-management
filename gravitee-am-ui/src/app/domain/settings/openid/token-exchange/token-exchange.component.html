<!--

    Copyright (C) 2015 The Gravitee team (http://gravitee.io)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<div class="gv-page-container">
  <div>
    <div fxFlex="70">
      <form (ngSubmit)="save()">
        <div class="gv-form-section" fxLayout="column">
          <mat-slide-toggle (change)="enableTokenExchange($event)" [checked]="isTokenExchangeEnabled()" [disabled]="!editMode">
            Enable Token Exchange
          </mat-slide-toggle>
          <mat-hint style="font-size: 75%">Enable OAuth 2.0 Token Exchange (RFC 8693)</mat-hint>
        </div>

        <div class="gv-form-section" fxLayout="column" *ngIf="isTokenExchangeEnabled()">
          <div class="gv-form-section-title">
            <h5>Token Exchange Settings</h5>
            <mat-divider></mat-divider>
          </div>

          <div class="gv-form-section" fxLayout="column">
            <mat-slide-toggle
              name="allowImpersonation"
              (change)="modelChanged()"
              [(ngModel)]="domain.oidc.tokenExchangeSettings.allowImpersonation"
              [disabled]="!editMode"
            >
              Allow Impersonation
            </mat-slide-toggle>
            <mat-hint style="font-size: 75%"
              >In an impersonation flow, the client swaps a subject token for an access token that contains the identity of the user
              represented by the subject token.</mat-hint
            >
          </div>

          <div class="gv-form-section" fxLayout="column">
            <mat-slide-toggle
              name="allowDelegation"
              (change)="modelChanged()"
              [(ngModel)]="domain.oidc.tokenExchangeSettings.allowDelegation"
              [disabled]="!editMode"
            >
              Allow Delegation
            </mat-slide-toggle>
            <mat-hint style="font-size: 75%"
              >In a delegation flow, the client swaps a subject token for an access token that contains the identity of both the client and
              the user represented by the subject token.</mat-hint
            >
          </div>

          <div class="gv-form-section" fxLayout="column">
            <mat-slide-toggle
              name="requireClientAuthentication"
              (change)="modelChanged()"
              [(ngModel)]="domain.oidc.tokenExchangeSettings.requireClientAuthentication"
              [disabled]="!editMode"
            >
              Require Client Authentication
            </mat-slide-toggle>
            <mat-hint style="font-size: 75%">Whether client authentication is required for the token exchange request.</mat-hint>
          </div>

          <div class="gv-form-section" fxLayout="column">
            <mat-slide-toggle
              name="allowScopeDownscoping"
              (change)="modelChanged()"
              [(ngModel)]="domain.oidc.tokenExchangeSettings.allowScopeDownscoping"
              [disabled]="!editMode"
            >
              Allow Scope Downscoping
            </mat-slide-toggle>
            <mat-hint style="font-size: 75%">Whether the requested scopes can be a subset of the subject token scopes.</mat-hint>
          </div>

          <mat-form-field appearance="outline">
            <mat-label>Token Lifetime Multiplier</mat-label>
            <input
              matInput
              type="number"
              name="tokenLifetimeMultiplier"
              step="0.1"
              min="0.1"
              (ngModelChange)="modelChanged()"
              [(ngModel)]="domain.oidc.tokenExchangeSettings.tokenLifetimeMultiplier"
              [disabled]="!editMode"
            />
            <mat-hint>Multiplier applied to the default token lifetime for exchanged tokens.</mat-hint>
          </mat-form-field>
        </div>

        <div fxLayout="row" *ngIf="editMode">
          <button mat-raised-button color="primary" [disabled]="!formChanged" type="submit">SAVE</button>
        </div>
      </form>
    </div>
    <div class="gv-page-description" fxFlex>
      <h3>What is Token Exchange ?</h3>
      <div class="gv-page-description-content">
        <p>
          OAuth 2.0 Token Exchange (<a href="https://datatracker.ietf.org/doc/html/rfc8693">RFC 8693</a>) defines a protocol for a client to
          exchange an existing token (subject token) for a new token.
        </p>
        <p>
          This is commonly used in microservices architectures where a service needs to call another service on behalf of a user or another
          service.
        </p>
      </div>
    </div>
  </div>
</div>
