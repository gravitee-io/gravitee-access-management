<!--

    Copyright (C) 2015 The Gravitee team (http://gravitee.io)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<div class="gv-page-container">
  <a routerLink="../">&lt;&lt; Back to Password Policies</a>
  <h1 style="margin-top: 20px" *ngIf="policyId">Password Policy</h1>
  <h1 style="margin-top: 20px" *ngIf="!policyId">Create New Password Policy</h1>
  <div>
    <div fxFlex="70">
      <form (ngSubmit)="save()" (keydown.enter)="(false)" fxLayout="column" #applicationForm="ngForm">
        <div>
          <div class="gv-form-section">
            <div fxLayout="row" class="form-alignment">
              <mat-form-field appearance="outline" floatLabel="always" class="large-input">
                <mat-label>Name</mat-label>
                <input
                  matInput
                  name="name"
                  [(ngModel)]="passwordPolicy.name"
                  required
                  (ngModelChange)="formChange()"
                  placeholder="Password Policy Name"
                />
              </mat-form-field>
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-form-field appearance="outline" floatLabel="always" class="large-input">
                <mat-label>Minimum length</mat-label>
                <input
                  matInput
                  type="number"
                  name="minLength"
                  [(ngModel)]="passwordPolicy.minLength"
                  [min]="0"
                  [max]="passwordPolicy.maxLength"
                  (ngModelChange)="formChange()"
                  placeholder="Minimum length"
                />
              </mat-form-field>
              <mat-icon class="info" matTooltip="Passwords shorter than 8 characters are considered to be weak (OWASP recommendation)."
                >info_outline</mat-icon
              >
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-form-field appearance="outline" floatLabel="always" class="large-input">
                <mat-label>Maximum length</mat-label>
                <input
                  matInput
                  type="number"
                  name="maxLength"
                  [(ngModel)]="passwordPolicy.maxLength"
                  [min]="passwordPolicy.minLength"
                  (ngModelChange)="formChange()"
                  [disabled]="!editMode"
                  placeholder="Maximum length"
                />
              </mat-form-field>
              <mat-icon
                class="info"
                matTooltip="A common maximum length is 64 characters due to limitations in certain hashing
                  algorithms (OWASP recommendation)."
                >info_outline</mat-icon
              >
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-form-field appearance="outline" floatLabel="always" class="large-input">
                <mat-label>Max consecutive letters</mat-label>
                <mat-select
                  [(value)]="passwordPolicy.maxConsecutiveLetters"
                  (selectionChange)="formChange()"
                  [disabled]="!editMode"
                  placeholder="Max number of consecutive letters."
                >
                  <mat-option [value]="null">Unlimited</mat-option>
                  <mat-option *ngFor="let p of [1, 2, 3, 4, 5]" [value]="p">{{ p }}</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-form-field appearance="outline" floatLabel="always" class="large-input">
                <mat-label>Expiration</mat-label>
                <input
                  matInput
                  type="number"
                  name="expiryDuration"
                  [(ngModel)]="passwordPolicy.expiryDuration"
                  [min]="0"
                  (ngModelChange)="formChange()"
                  [disabled]="!editMode"
                  placeholder="Expiration (Days)"
                />
              </mat-form-field>
              <mat-icon
                class="info"
                matTooltip="Determines how long a password can be used before the user is required to change it. Configuring the setting to 90 or 180
                  days is standard practice in most organizations. To deactivate this feature just put 0 as value.
                  "
                >info_outline</mat-icon
              >
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-slide-toggle
                [checked]="passwordPolicy.includeNumbers"
                (change)="setIncludeNumbers($event); formChange()"
                [disabled]="!editMode"
              >
                Password must include numbers
              </mat-slide-toggle>
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-slide-toggle
                [checked]="passwordPolicy.includeSpecialCharacters"
                (change)="setIncludeSpecialCharacters($event); formChange()"
                [disabled]="!editMode"
              >
                Password must include special characters
              </mat-slide-toggle>
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-slide-toggle
                [checked]="passwordPolicy.lettersInMixedCase"
                (change)="setLettersInMixedValue($event); formChange()"
                [disabled]="!editMode"
              >
                Password must include letters in mixed case
              </mat-slide-toggle>
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-slide-toggle
                [checked]="passwordPolicy.excludePasswordsInDictionary"
                (change)="setExcludePasswordsInDictionary($event); formChange()"
                [disabled]="!editMode"
              >
                Exclude common passwords
              </mat-slide-toggle>
              <mat-icon class="info" matTooltip="Common unsafe passwords (e.g: 123456, qwertyuiop, trustno1, ...).">info_outline</mat-icon>
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-slide-toggle
                [checked]="passwordPolicy.excludeUserProfileInfoInPassword"
                (change)="setExcludeUserProfileInfoInPassword($event); formChange()"
                [disabled]="!editMode"
              >
                Exclude user profile information from passwords
              </mat-slide-toggle>
              <mat-icon
                class="info"
                matTooltip="User profile information like username, firstname, lastname, middle-name, nickname, email, phone
                numbers will be excluded from passwords"
                >info_outline</mat-icon
              >
            </div>

            <div fxLayout="row" class="form-alignment">
              <mat-slide-toggle
                [checked]="passwordPolicy.passwordHistoryEnabled"
                (change)="setPasswordHistoryEnabled($event); formChange()"
                [disabled]="!editMode"
              >
                Maintain password History
              </mat-slide-toggle>
              <mat-icon class="info" matTooltip="Password history for each user will be maintained to prevent reuse of old passwords"
                >info_outline</mat-icon
              >
            </div>

            <div fxLayout="row" class="form-alignment" *ngIf="passwordPolicy.passwordHistoryEnabled">
              <mat-form-field appearance="outline" floatLabel="always">
                <mat-label>Password history size</mat-label>
                <input
                  matInput
                  type="number"
                  name="oldPasswords"
                  [(ngModel)]="passwordPolicy.oldPasswords"
                  [min]="1"
                  [max]="24"
                  (ngModelChange)="formChange()"
                  [disabled]="!editMode"
                  placeholder="Password history size (maximum value is 24)"
                />
              </mat-form-field>
            </div>
          </div>

          <div fxLayout="row" fxLayoutGap="10px">
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="
                (this.editMode && (!applicationForm.valid || applicationForm.pristine) && (!applicationForm.valid || !formChanged)) ||
                !this.editMode
              "
            >
              Save
            </button>
          </div>
        </div>
      </form>
    </div>
    <div class="gv-page-description" fxFlex>
      <h3>Password policy</h3>
      <div class="gv-page-description-content">
        <p>Create a password policy and it's criteria for each of your Identity Providers.</p>
      </div>
    </div>
  </div>
</div>
