<!--

    Copyright (C) 2015 The Gravitee team (http://gravitee.io)

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

            http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->
<div class="gv-page-container" fxLayout="column">
  <a [routerLink]="['..']" class="gv-back-link"><small><< Back to MCP Servers</small></a>
  <h1>New MCP server</h1>
  <div class="gv-page-content" fxLayout="row">
    <form fxLayout="column">
      <div class="gv-form-section">
        <div class="gv-form-section-title">
          <h5>MCP Server Settings</h5>
          <mat-divider></mat-divider>
        </div>
        <div>
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Domain</mat-label>
            <input matInput type="text" placeholder="Domain" name="domain" [value]="domain.name" disabled />
            <mat-hint>MCP server's security domain.</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Name</mat-label>
            <input matInput type="text" placeholder="Enter the MCP server's name" name="name" [(ngModel)]="newMcpServer.name" required />
            <mat-hint>The MCP server's name</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>MCP Resource Identifier</mat-label>
            <input
              matInput
              type="text"
              placeholder="MCP Resource Identifier (e.g. https://banking.example.com)"
              name="name"
              [(ngModel)]="newMcpServer.resourceIdentifier"
              required
            />
            <mat-hint>The canonical resource identifier of your MCP Server</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Description</mat-label>
            <textarea
              matInput
              type="text"
              placeholder="Enter the MCP server description"
              name="description"
              [(ngModel)]="newMcpServer.description"
            ></textarea>
            <mat-hint>The MCP server's description</mat-hint>
          </mat-form-field>
        </div>
      </div>
      <div class="gv-form-section">
        <div class="gv-form-section-title">
          <div class="tools-theme-container">
            <div>
              <h5>Tools Configuration</h5>
              <p>Define the tools that this MCP server provides. Tools can be tied to specific scopes.</p>
            </div>
            <button mat-raised-button class="create-button" color="secondary" (click)="openAddToolModal($event)">
              <mat-icon>add</mat-icon> Add tool
            </button>
          </div>
          <mat-divider></mat-divider>
          <div *ngIf="newMcpServer.tools.length === 0" class="tools-empty-container">
            <div>
              <mat-icon>create_new_folder</mat-icon>
            </div>
            <span class="first-line">No tools configured yet</span>
            <span>Add tools to define what this MCP server provides</span>
          </div>
          <mcp-tools-table [tools]="newMcpServer.tools" [showDeleteIcon]="true" (delete)="removeTool($event.key)"></mcp-tools-table>
        </div>
      </div>
      <div class="gv-form-section">
        <div class="gv-form-section-title">
          <h5>OAuth 2.0 Settings (Optional)</h5>
          <mat-divider></mat-divider>
        </div>
        <div>
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Client ID</mat-label>
            <input matInput type="text" placeholder="Client ID" name="client_id" [(ngModel)]="newMcpServer.clientId" />
            <mat-hint>Public identifier for the MCP server required for OAuth 2.0 protocol.</mat-hint>
          </mat-form-field>
          <mat-form-field appearance="outline" floatLabel="always">
            <mat-label>Client Secret</mat-label>
            <input matInput type="text" placeholder="Client Secret" name="client_secret" [(ngModel)]="newMcpServer.clientSecret" />
            <mat-hint>Secret used by the MCP server to request OAuth 2.0 tokens.</mat-hint>
          </mat-form-field>
        </div>
      </div>
      <button mat-raised-button class="create-button" color="primary" (click)="registerMcpServer()" [disabled]="!formValid()">
        Create
      </button>
    </form>
    <div class="gv-page-description" fxFlex>
      <h3>MCP server?</h3>
      <div class="gv-page-description-content">
        <p>
          MCP Servers act as a bridge, verifying user credentials and permissions before granting access to protected resources. They
          support various application types, including mobile, web, and backend services, ensuring secure authentication across different
          platforms.
        </p>
      </div>
    </div>
  </div>
</div>
