{
	"info": {
		"_postman_id": "3358ed0c-3a3a-4552-bb0f-972d93d0e6ae",
		"name": "Gravitee.io - AM - Openid Core - Request Object",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Prepare",
			"item": [
				{
					"name": "Generate admin token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var token = JSON.parse(responseBody);",
									"pm.environment.set('token', token.access_token);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW5hZG1pbg=="
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "password",
									"value": "adminadmin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{management_url}}/management/auth/token",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"auth",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create request_object domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"DCR disabled for domain\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.allowLocalhostRedirectUri).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.allowHttpSchemeRedirectUri).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.allowWildCardRedirectUri).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.isDynamicClientRegistrationEnabled).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.isOpenDynamicClientRegistrationEnabled).to.eql(false);",
									"    ",
									"    pm.environment.set('domain', jsonData.id);",
									"    pm.environment.set('domainHrid', jsonData.hrid);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"request-object\", \n\t\"description\": \"test request object parameters\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "Enable DCR - non open mode",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"DCR enabled for domain\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.isDynamicClientRegistrationEnabled).to.eql(true);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"oidc\": {\n    \"clientRegistrationSettings\": {\n      \"allowLocalhostRedirectUri\": false,\n      \"allowHttpSchemeRedirectUri\": false,\n      \"allowWildCardRedirectUri\": false,\n      \"isDynamicClientRegistrationEnabled\": true,\n      \"isOpenDynamicClientRegistrationEnabled\": false\n    }\n  }\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete default identity provider",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 204\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"#CoMpL3X-P@SsW0Rd\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities/default-idp-{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities",
								"default-idp-{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create in-memory IDP",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var body = JSON.parse(responseBody);",
									"pm.environment.set('idp.inmemory', body.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"domainWhitelist\" : [],\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"#CoMpL3X-P@SsW0Rd\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get default certificate ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Get default certificate id\", function () {",
									"    pm.response.to.be.header('Content-Type', 'application/json');",
									"    var body = pm.response.json();",
									"    pm.environment.set('defaultCertificateId', body[0].id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete default certificate",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 204\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"#CoMpL3X-P@SsW0Rd\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates/{{defaultCertificateId}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates",
								"{{defaultCertificateId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create jks certificate rs256",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Extension Grant - create jks certificate\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.environment.set('certificateJks', jsonData.id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"type\": \"javakeystore-am-certificate\",\n  \"configuration\": \"{\\\"jks\\\":\\\"{\\\\\\\"name\\\\\\\":\\\\\\\"server.jks\\\\\\\",\\\\\\\"type\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"size\\\\\\\":2237,\\\\\\\"content\\\\\\\":\\\\\\\"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\\\\\\\"}\\\",\\\"storepass\\\":\\\"letmein\\\",\\\"alias\\\":\\\"mytestkey\\\",\\\"keypass\\\":\\\"changeme\\\", \\\"use\\\" : [\\\"enc\\\", \\\"sig\\\"]}\",\n  \"name\": \"Test\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create jks certificate rs256 for encrypted RequetObject",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Extension Grant - create jks certificate\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.environment.set('certificateJks', jsonData.id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\"type\":\"pkcs12-am-certificate\",\"configuration\":\"{\\\"content\\\":\\\"{\\\\\\\"name\\\\\\\":\\\\\\\"client1.jwks.pkcs12\\\\\\\",\\\\\\\"type\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"size\\\\\\\":2734,\\\\\\\"content\\\\\\\":\\\\\\\"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\\\\\"}\\\",\\\"storepass\\\":\\\"changeit\\\",\\\"alias\\\":\\\"client1-jwks\\\",\\\"keypass\\\":\\\"changeit\\\",\\\"algorithm\\\":\\\"RS256\\\", \\\"use\\\" : [\\\"enc\\\", \\\"sig\\\"]}\",\"name\":\"client1-jwks\"}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create jks certificate rs512",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Extension Grant - create jks certificate\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.environment.set('certificateJksRs512', jsonData.id);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 1000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"type\": \"javakeystore-am-certificate\",\n  \"configuration\": \"{\\\"jks\\\":\\\"{\\\\\\\"name\\\\\\\":\\\\\\\"server.jks\\\\\\\",\\\\\\\"type\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"size\\\\\\\":2237,\\\\\\\"content\\\\\\\":\\\\\\\"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\\\\\\\"}\\\",\\\"storepass\\\":\\\"letmein\\\",\\\"alias\\\":\\\"mytestkey\\\",\\\"keypass\\\":\\\"changeme\\\"}\",\n  \"name\": \"Test\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Start domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// wait for sync process",
									"setTimeout(function(){}, 10000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"enabled\": true\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "well-known/openid-configuration",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Check discovery endpoints\", function () {",
									"    pm.response.to.be.header('Content-Type', 'application/json');",
									"    var body = pm.response.json();",
									"    ",
									"    pm.expect(body).to.have.property(\"authorization_endpoint\");",
									"    pm.expect(body).to.have.property(\"token_endpoint\");",
									"    pm.expect(body).to.have.property(\"revocation_endpoint\");",
									"    pm.expect(body).to.have.property(\"userinfo_endpoint\");",
									"    pm.expect(body).to.have.property(\"registration_endpoint\");",
									"    pm.expect(body).to.have.property(\"registration_renew_secret_endpoint\");",
									"",
									"    pm.environment.set('authorizationEndpoint', body.authorization_endpoint);",
									"    pm.environment.set('tokenEndpoint', body.token_endpoint);",
									"    pm.environment.set('userinfoEndpoint', body.userinfo_endpoint);",
									"    pm.environment.set('revocationEndpoint', body.revocation_endpoint);",
									"    pm.environment.set('registrationEndpoint', body.registration_endpoint);",
									"    pm.environment.set('registrationRenewSecretEndpoint', body.registration_renew_secret_endpoint);",
									"    pm.environment.set('logoutEndpoint', body.end_session_endpoint);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/{{domainHrid}}/oidc/.well-known/openid-configuration",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"{{domainHrid}}",
								"oidc",
								".well-known",
								"openid-configuration"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Create DCR client",
			"item": [
				{
					"name": "Create client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var body = JSON.parse(responseBody);",
									"pm.environment.set('clientDCR', body.id);",
									"pm.environment.set('clientId', body.settings.oauth.clientId);",
									"pm.environment.set('clientSecret', body.settings.oauth.clientSecret);",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 6000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"dcr-client-public-name\",\n  \"type\": \"SERVICE\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications"
							]
						}
					},
					"response": []
				},
				{
					"name": "Configure client with DCR enabled",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"DCR enabled for client\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.settings.oauth.scopeSettings[0].scope).to.eql('dcr_admin');",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 6000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"settings\": {\n\t\t\"oauth\": {\n\t\t\t\"scopeSettings\": [ {\"scope\" : \"dcr_admin\"}]\n\t\t}\n\t}\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications/{{clientDCR}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications",
								"{{clientDCR}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Generate token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Has an access_token\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body).to.have.property('access_token');",
									"    pm.expect(body.scope).to.eql('dcr_admin');",
									"    ",
									"    pm.environment.set('access_token', body.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "{{clientSecret}}",
									"type": "string"
								},
								{
									"key": "username",
									"value": "{{clientId}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "dcr_admin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{tokenEndpoint}}",
							"host": [
								"{{tokenEndpoint}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Case - Invalid requests",
			"item": [
				{
					"name": "Generate token for DCR client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Has an access_token\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body).to.have.property('access_token');",
									"    pm.expect(body.scope).to.eql('dcr_admin');",
									"    ",
									"    pm.environment.set('access_token', body.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "{{clientSecret}}",
									"type": "string"
								},
								{
									"key": "username",
									"value": "{{clientId}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "dcr_admin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{tokenEndpoint}}",
							"host": [
								"{{tokenEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register new client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Has default attributes\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body.client_name).to.eql('client_rs256');",
									"",
									"    pm.expect(body).to.have.property('client_id');",
									"    pm.expect(body).to.have.property('client_secret');",
									"    ",
									"    pm.environment.set('ro_client_id', body.client_id);",
									"    ",
									"    pm.environment.set('registrationAccessToken', body.registration_access_token);",
									"    pm.environment.set('registrationClientUri', body.registration_client_uri);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 6000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"client_name\":\"client_rs256\",\n    \"redirect_uris\": [\"https://op-test:60001/authz_cb\"],\n    \"application_type\": \"web\",\n    \"contacts\": [\"roland@example.com\"],\n    \"response_types\": [\"code\",\"token\",\"id_token\"],\n    \"grant_types\": [\"authorization_code\",\"implicit\",\"password\"],\n    \"scope\": \"openid\",\n    \"post_logout_redirect_uris\": [\"https://op-test:60001/logout\"],\n    \"token_endpoint_auth_method\": \"client_secret_basic\",\n    \"jwks\": {\n        \"keys\": [\n            {\n            \t\"use\": \"sig\",\n                \"kid\": \"rsa-signature\",\n                \"kty\": \"RSA\",\n                \"e\": \"AQAB\",\n                \"n\": \"4-iLfs52Ta-7s3W_X4-E-f8SwigNhOqigF0Mjoce8mWTQGjS9U1kOuSJKnS9c4gf5vZhBB8iGkufMDvl5nwB0JgcihG6QUiN1NT8WPasJLjRTYQmJNCIYBac0oSZfHIUq8C4kmbFbWqXdp3uB-0l9qalD_HlckBt6lJ4VEb-ntbDpWgQnSxtRDzPZgH_kqJ3sNGnXnd5uNcG1W9v0IC-Wz1-kZ1eFM9-HqfnhGLr4yOr1sSeRQTJUaT12ixSKwn7qBJvnSSUlevIao-Zje2wnvTGVAgsEIuGulw0KWH9hLnYecyTPf3YR7v9sv8ff1qpn0LOmOWOfXYvXqteEcdh9w\"\n            }\n        ]\n    }\n}"
						},
						"url": {
							"raw": "{{registrationEndpoint}}",
							"host": [
								"{{registrationEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "With request and request_uri parameters",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.be.header('Content-Length', '0');",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should be a location error\", function() {",
									"    var location = postman.getResponseHeader('Location');",
									"    let domain = pm.environment.get(\"domain\");",
									"    ",
									"    tests['Redirect to redirect_uri'] = location.startsWith(\"https://op-test:60001/authz_cb?error\");",
									"    tests['Contains an error query-parameter'] = location.includes('error=invalid_request');",
									"    tests['Contains an error description query-parameter'] = location.includes('error_description=request+and+request_uri+parameters+must+not+be+use+in+the+same+request');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=https://op-test:60001/authz_cb&state=1234-5678-9876&request=invalid_jwt&request_uri=invalid_uri&scope=openid",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "https://op-test:60001/authz_cb"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "invalid_jwt"
								},
								{
									"key": "request_uri",
									"value": "invalid_uri"
								},
								{
									"key": "scope",
									"value": "openid"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "With invalid signature algorithm",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.be.header('Content-Length', '0');",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should be a location error\", function() {",
									"    var location = postman.getResponseHeader('Location');",
									"    let domain = pm.environment.get(\"domainHrid\");",
									"    ",
									"    tests['Redirect to redirect_uri'] = location.startsWith(pm.environment.get('gateway_url') + '/' + domain + '/oauth/error');",
									"    tests['Contains an error query-parameter'] = location.includes('error=invalid_request_object');",
									"    tests['Contains an error description query-parameter'] = location.includes('error_description=Invalid+request+object+signing+algorithm');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=https://op-test:60001/authz_cb&state=1234-5678-9876&request=eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsImV4cCI6MTU4ODY4NTc2MX0.sx-QW8xbhMuousR5_j7wNg_HQ-2I4T38uQcvUq7RXh0JaWPEoerMMZVXi6UG_-q_kbF4n93G9hxyVCVzcGKrmyNLE5AaNjmFUe2WgYe4JEO59aUjP9QZ3jdw5O3KhEaH6emUDr05gR1ZdI9XR6R4BxzCKaiCUK16cTl_-_0Hwo4oIKO6lj-1DdpS9sVJ_AyvxrQ8JEdjjTKnZTcTx4wiB7-qYBkmWD8HpeO_621i3dxBms4FbFIp9VfbcPrI9_w8aoLd02Gq9GnQaOqekGSeIW3sX1pWOvUdjbSuWJkREhZZJSO00b48UQdLAJgb8mn-Bl9Jvt7JFy-9erXxi6fU_w&scope=openid",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "https://op-test:60001/authz_cb"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsImV4cCI6MTU4ODY4NTc2MX0.sx-QW8xbhMuousR5_j7wNg_HQ-2I4T38uQcvUq7RXh0JaWPEoerMMZVXi6UG_-q_kbF4n93G9hxyVCVzcGKrmyNLE5AaNjmFUe2WgYe4JEO59aUjP9QZ3jdw5O3KhEaH6emUDr05gR1ZdI9XR6R4BxzCKaiCUK16cTl_-_0Hwo4oIKO6lj-1DdpS9sVJ_AyvxrQ8JEdjjTKnZTcTx4wiB7-qYBkmWD8HpeO_621i3dxBms4FbFIp9VfbcPrI9_w8aoLd02Gq9GnQaOqekGSeIW3sX1pWOvUdjbSuWJkREhZZJSO00b48UQdLAJgb8mn-Bl9Jvt7JFy-9erXxi6fU_w"
								},
								{
									"key": "scope",
									"value": "openid"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Patch client -  with request_object_signing_alg RS256",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Get client with response types\", function () {",
									"    pm.response.to.be.header('Content-Type', 'application/json');",
									"    var body = pm.response.json();",
									"    pm.expect(body.request_object_signing_alg).to.eql('RS256');",
									"});",
									"",
									"pm.test(\"One time Token\", function() {",
									"    var body = pm.response.json();",
									"    pm.expect(body).to.have.property('registration_access_token');",
									"    pm.expect(body.registration_access_token).to.not.eql(pm.environment.get('registrationAccessToken'));",
									"    pm.environment.set('registrationAccessToken', body.registration_access_token);",
									"    pm.environment.set('registrationClientUri', body.registration_client_uri);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{registrationAccessToken}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"request_object_signing_alg\": \"RS256\"\n}"
						},
						"url": {
							"raw": "{{registrationClientUri}}",
							"host": [
								"{{registrationClientUri}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "With invalid client_id in request object",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.be.header('Content-Length', '0');",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should be a location error\", function() {",
									"    var location = postman.getResponseHeader('Location');",
									"    let domain = pm.environment.get(\"domain\");",
									"    ",
									"    tests['Redirect to redirect_uri'] = location.startsWith(\"https://op-test:60001/authz_cb?error\");",
									"    tests['Contains an error query-parameter'] = location.includes('error=invalid_request_object');",
									"    tests['Contains an error description query-parameter'] = location.includes('error_description=client_id+does+not+match+request+parameter');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=https://op-test:60001/authz_cb&state=1234-5678-9876&request=eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsImV4cCI6MTU4ODY4NTg3NiwiY2xpZW50X2lkIjoidW5rbm93bl9jbGllbnQifQ.XN-Fgy6M9aBJPwWsatQ9qgtf0sfWCo0hzDqe2-HHeMzJHFpj3pe0Yp--VLxlSG1LxzpqfCBL6QuHzUH6Rslz_tYhobOY13054-xkuQMDdbtjgFlKtdoMh15tKdPJCqPIMdaWpsi9bV2qiXYPVIYuE9ywmt_UETh5Hs166IgZ_SkITxfPf1LOuk0jQVkr-eppe1qymqHCzXBSXeVcVyP55sPTjEpNk5d-hsv3Z35Q6sdG3tpg688k-157coJHCpoMKGwLAVC9RscgqaDf30Mhyg4uejqLyenMb-ImWkIhc1i7HWfbwea5-d7o0NeVjKpE2HYORbp93QRKZrDXN8ckxw&scope=openid",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "https://op-test:60001/authz_cb"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsImV4cCI6MTU4ODY4NTg3NiwiY2xpZW50X2lkIjoidW5rbm93bl9jbGllbnQifQ.XN-Fgy6M9aBJPwWsatQ9qgtf0sfWCo0hzDqe2-HHeMzJHFpj3pe0Yp--VLxlSG1LxzpqfCBL6QuHzUH6Rslz_tYhobOY13054-xkuQMDdbtjgFlKtdoMh15tKdPJCqPIMdaWpsi9bV2qiXYPVIYuE9ywmt_UETh5Hs166IgZ_SkITxfPf1LOuk0jQVkr-eppe1qymqHCzXBSXeVcVyP55sPTjEpNk5d-hsv3Z35Q6sdG3tpg688k-157coJHCpoMKGwLAVC9RscgqaDf30Mhyg4uejqLyenMb-ImWkIhc1i7HWfbwea5-d7o0NeVjKpE2HYORbp93QRKZrDXN8ckxw"
								},
								{
									"key": "scope",
									"value": "openid"
								}
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Case - Invalid requests - forbidden request_uri",
			"item": [
				{
					"name": "Generate token for DCR client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Has an access_token\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body).to.have.property('access_token');",
									"    pm.expect(body.scope).to.eql('dcr_admin');",
									"    ",
									"    pm.environment.set('access_token', body.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "{{clientSecret}}",
									"type": "string"
								},
								{
									"key": "username",
									"value": "{{clientId}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "dcr_admin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{tokenEndpoint}}",
							"host": [
								"{{tokenEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register new client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Has default attributes\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body.client_name).to.eql('client_request_uri');",
									"",
									"    pm.expect(body).to.have.property('client_id');",
									"    pm.expect(body).to.have.property('client_secret');",
									"    ",
									"    pm.environment.set('ro_client_id', body.client_id);",
									"    ",
									"    pm.environment.set('registrationAccessToken', body.registration_access_token);",
									"    pm.environment.set('registrationClientUri', body.registration_client_uri);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 6000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"client_name\":\"client_request_uri\",\n    \"redirect_uris\": [\"https://op-test:60001/authz_cb\"],\n    \"application_type\": \"web\",\n    \"contacts\": [\"roland@example.com\"],\n    \"response_types\": [\"code\",\"token\",\"id_token\"],\n    \"grant_types\": [\"authorization_code\",\"implicit\",\"password\"],\n    \"scope\": \"openid\",\n    \"post_logout_redirect_uris\": [\"https://op-test:60001/logout\"],\n    \"request_uris\": [\"https://op-test:60001/request/uri\"],\n    \"token_endpoint_auth_method\": \"client_secret_basic\",\n    \"jwks\": {\n        \"keys\": [\n            {\n            \t\"use\": \"sig\",\n                \"kid\": \"rsa-signature\",\n                \"kty\": \"RSA\",\n                \"e\": \"AQAB\",\n                \"n\": \"4-iLfs52Ta-7s3W_X4-E-f8SwigNhOqigF0Mjoce8mWTQGjS9U1kOuSJKnS9c4gf5vZhBB8iGkufMDvl5nwB0JgcihG6QUiN1NT8WPasJLjRTYQmJNCIYBac0oSZfHIUq8C4kmbFbWqXdp3uB-0l9qalD_HlckBt6lJ4VEb-ntbDpWgQnSxtRDzPZgH_kqJ3sNGnXnd5uNcG1W9v0IC-Wz1-kZ1eFM9-HqfnhGLr4yOr1sSeRQTJUaT12ixSKwn7qBJvnSSUlevIao-Zje2wnvTGVAgsEIuGulw0KWH9hLnYecyTPf3YR7v9sv8ff1qpn0LOmOWOfXYvXqteEcdh9w\"\n            }\n        ]\n    }\n}"
						},
						"url": {
							"raw": "{{registrationEndpoint}}",
							"host": [
								"{{registrationEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "With forbidden request_uri parameters",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.be.header('Content-Length', '0');",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should be a location error\", function() {",
									"    var location = postman.getResponseHeader('Location');",
									"    let domain = pm.environment.get(\"domain\");",
									"    ",
									"    tests['Redirect to redirect_uri'] = location.startsWith(\"https://op-test:60001/authz_cb?error\");",
									"    tests['Contains an error query-parameter'] = location.includes('error=invalid_request_uri');",
									"    tests['Contains an error description query-parameter'] = location.includes('error_description=The+request_uri+MUST+match+the+registered+URL+for+this+application');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=https://op-test:60001/authz_cb&state=1234-5678-9876&scope=openid&request_uri=https://somewhere",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "https://op-test:60001/authz_cb"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "scope",
									"value": "openid"
								},
								{
									"key": "request_uri",
									"value": "https://somewhere"
								}
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Case - Nominal - Signed Request Object",
			"item": [
				{
					"name": "Generate token for DCR client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Has an access_token\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body).to.have.property('access_token');",
									"    pm.expect(body.scope).to.eql('dcr_admin');",
									"    ",
									"    pm.environment.set('access_token', body.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "{{clientSecret}}",
									"type": "string"
								},
								{
									"key": "username",
									"value": "{{clientId}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "dcr_admin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{tokenEndpoint}}",
							"host": [
								"{{tokenEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register new client - RS256",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Has default attributes\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body.client_name).to.eql('client_rs256');",
									"",
									"    pm.expect(body).to.have.property('client_id');",
									"    pm.expect(body).to.have.property('client_secret');",
									"    pm.expect(body.request_object_signing_alg).to.eql('RS256');",
									"    ",
									"    pm.environment.set('ro_client_id', body.client_id);",
									"    ",
									"    pm.environment.set('registrationAccessToken', body.registration_access_token);",
									"    pm.environment.set('registrationClientUri', body.registration_client_uri);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 6000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"client_name\": \"client_rs256\",\n    \"redirect_uris\": [\n        \"https://op-test:60001/authz_cb\",\n        \"https://op-test-from-query-param:60001/authz_cb\"\n    ],\n    \"application_type\": \"web\",\n    \"contacts\": [\n        \"roland@example.com\"\n    ],\n    \"response_types\": [\n        \"code\",\n        \"token\",\n        \"id_token\"\n    ],\n    \"grant_types\": [\n        \"authorization_code\",\n        \"implicit\",\n        \"password\"\n    ],\n    \"scope\": \"openid\",\n    \"post_logout_redirect_uris\": [\n        \"https://op-test:60001/logout\"\n    ],\n    \"token_endpoint_auth_method\": \"client_secret_basic\",\n    \"request_object_signing_alg\": \"RS256\",\n    \"jwks\": {\n        \"keys\": [\n            {\n            \t\"use\": \"sig\",\n                \"kid\": \"rsa-signature\",\n                \"kty\": \"RSA\",\n                \"e\": \"AQAB\",\n                \"n\": \"4-iLfs52Ta-7s3W_X4-E-f8SwigNhOqigF0Mjoce8mWTQGjS9U1kOuSJKnS9c4gf5vZhBB8iGkufMDvl5nwB0JgcihG6QUiN1NT8WPasJLjRTYQmJNCIYBac0oSZfHIUq8C4kmbFbWqXdp3uB-0l9qalD_HlckBt6lJ4VEb-ntbDpWgQnSxtRDzPZgH_kqJ3sNGnXnd5uNcG1W9v0IC-Wz1-kZ1eFM9-HqfnhGLr4yOr1sSeRQTJUaT12ixSKwn7qBJvnSSUlevIao-Zje2wnvTGVAgsEIuGulw0KWH9hLnYecyTPf3YR7v9sv8ff1qpn0LOmOWOfXYvXqteEcdh9w\"\n            }\n        ]\n    }\n}"
						},
						"url": {
							"raw": "{{registrationEndpoint}}",
							"host": [
								"{{registrationEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Do not override state and nonce",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should redirect to login\", function() {",
									"    var location = postman.getResponseHeader('Location');",
									"    let domain = pm.environment.get(\"domainHrid\");",
									"    ",
									"    tests['Redirect to login page with client_id'] = location.includes(pm.environment.get('gateway_url') + '/' + domain + '/login') && location.includes('client_id=' + pm.environment.get('ro_client_id'));",
									"",
									"    pm.environment.set('redirection', location);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=https://op-test-from-query-param:60001/authz_cb&state=1234-5678-9876&request=eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsInN0YXRlIjoib3ZlcnJpZGUtc3RhdGUiLCJleHAiOjE1ODg2ODExMDAsIm5vbmNlIjoib3ZlcnJpZGUtbm9uY2UifQ.uQLxFiaReQwWqT-TnMXPNrIMdEaHMDlar90iuv_ub3njH1hTNIYV_IdRWs-2Skx5e9tYxnSNt7swHPE1aLKnnmylo52sa2-d7gOxkIiGzsnET8io-_AQsSocl25x8IiXP6IYyUSclVHFUNc_hjcbWkgw2oNXH8f6gx_z7nMahMbEW0L2XlA7fq7SZXzZE78hd9VZ3IaVVUHV90CafYt7kf_Y3Y7VpqoNPXpmfjLQKGWi9tXwmwfoS2OgqlrnXr5kVUiPhbO1OernunlZW7E3er3hBtguhYNzgtXU2iZQEjUD-rPfrnEJdNxdCxq8DnSgKJxBIzabjaJLG5BdgVD7qw&scope=openid&nonce=n-0S6_WzA2Mj&max_age=120000",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "https://op-test-from-query-param:60001/authz_cb"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsInN0YXRlIjoib3ZlcnJpZGUtc3RhdGUiLCJleHAiOjE1ODg2ODExMDAsIm5vbmNlIjoib3ZlcnJpZGUtbm9uY2UifQ.uQLxFiaReQwWqT-TnMXPNrIMdEaHMDlar90iuv_ub3njH1hTNIYV_IdRWs-2Skx5e9tYxnSNt7swHPE1aLKnnmylo52sa2-d7gOxkIiGzsnET8io-_AQsSocl25x8IiXP6IYyUSclVHFUNc_hjcbWkgw2oNXH8f6gx_z7nMahMbEW0L2XlA7fq7SZXzZE78hd9VZ3IaVVUHV90CafYt7kf_Y3Y7VpqoNPXpmfjLQKGWi9tXwmwfoS2OgqlrnXr5kVUiPhbO1OernunlZW7E3er3hBtguhYNzgtXU2iZQEjUD-rPfrnEJdNxdCxq8DnSgKJxBIzabjaJLG5BdgVD7qw"
								},
								{
									"key": "scope",
									"value": "openid"
								},
								{
									"key": "nonce",
									"value": "n-0S6_WzA2Mj"
								},
								{
									"key": "max_age",
									"value": "120000"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Redirect to login form",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Should be ok\", function () {",
									"    pm.response.to.be.ok;",
									"    ",
									"    // Extract the XSRF token to send it with the next request.",
									"    var responseHTML = cheerio.load(pm.response.text());",
									"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
									"    const action = responseHTML('form').attr('action');",
									"    pm.environment.set('xsrf', xsrfToken);",
									"    pm.environment.set('action', action);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Post login form",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "X-XSRF-TOKEN",
									"value": "{{xsrf}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "user",
									"type": "text"
								},
								{
									"key": "password",
									"value": "#CoMpL3X-P@SsW0Rd",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{action}}",
							"host": [
								"{{action}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Redirect after login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Redirect to consent",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Should be ok\", function () {",
									"    pm.response.to.be.ok;",
									"    ",
									"    // Extract the XSRF token to send it with the next request.",
									"    var responseHTML = cheerio.load(pm.response.text());",
									"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
									"    const action = responseHTML('form').attr('action');",
									"    pm.environment.set('xsrf', xsrfToken);",
									"    pm.environment.set('action', action);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Post consent form",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "X-XSRF-TOKEN",
									"value": "{{xsrf}}",
									"type": "text"
								},
								{
									"key": "scope.openid",
									"value": "true",
									"type": "text"
								},
								{
									"key": "user_oauth_approval",
									"value": "true",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{action}}",
							"host": [
								"{{action}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Redirect after consent",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected to client app\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"   const location = postman.getResponseHeader(\"Location\");",
									"",
									"    // State must come from request object",
									"    tests['Contains the request object state'] = location.includes('state=override-state');",
									"    ",
									"    // Redirect uri must match the one specified in query params.",
									"    tests['Redirect to query param redirect_uri'] = location.includes('https://op-test-from-query-param:60001/authz_cb');",
									"",
									"    // Redirect uri must match the one specified in query params.",
									"    tests['Contains a code'] = location.includes('code=');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Use redirect_uri from request_object",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should be redirected to client app\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"   const location = postman.getResponseHeader(\"Location\");",
									"",
									"    // State must come from request object",
									"    tests['Contains the request object state'] = location.includes('state=1234-5678-9876');",
									"    ",
									"    // Redirect uri must match the one specified in query params.",
									"    tests['Redirect to query param redirect_uri'] = location.includes('https://op-test:60001/authz_cb');",
									"",
									"    // Redirect uri must match the one specified in query params.",
									"    tests['Contains a code'] = location.includes('code=');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=http://unknown_but_overriden_uri/&state=1234-5678-9876&request=eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsInJlZGlyZWN0X3VyaSI6Imh0dHBzOlwvXC9vcC10ZXN0OjYwMDAxXC9hdXRoel9jYiIsImV4cCI6MTU4ODY4MTEzNX0.anyAlDScD_4qQjaj2mejrgG7sV_t9Dbhw9aloaCv7zNhZ0OL1BHBemvQ4zN6yXwvCd9IXOM7_uC6ayquxENnBF8bl53ukNVgzE3x52TEBap6ckXoDEaIdWWB7JukrofH_X0vXwBa2QH3tYSp4BRnXUCbvctADm-gTGv_qNDvZHOCmhSMYdN7HwVkWX5yfYDthQ-F7eS-ZbUH1jQqOAk5QI597p-wxdUq7k6IppQ3_g_x9K-bTZ2FfqkG4izHG0USl3VoyP5_gItPi7m6htKASw6y_L9l1twWAfEdI-uJbdYC4P-3p3fR92tlc_TPBLgpiLe6D4gt8CeUM5jBIsUZkw&scope=openid&nonce=n-0S6_WzA2Mj",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "http://unknown_but_overriden_uri/"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "eyJraWQiOiJyc2Etc2lnbmF0dXJlIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJhbGljZSIsImlzcyI6Imh0dHBzOlwvXC9jMmlkLmNvbSIsInJlZGlyZWN0X3VyaSI6Imh0dHBzOlwvXC9vcC10ZXN0OjYwMDAxXC9hdXRoel9jYiIsImV4cCI6MTU4ODY4MTEzNX0.anyAlDScD_4qQjaj2mejrgG7sV_t9Dbhw9aloaCv7zNhZ0OL1BHBemvQ4zN6yXwvCd9IXOM7_uC6ayquxENnBF8bl53ukNVgzE3x52TEBap6ckXoDEaIdWWB7JukrofH_X0vXwBa2QH3tYSp4BRnXUCbvctADm-gTGv_qNDvZHOCmhSMYdN7HwVkWX5yfYDthQ-F7eS-ZbUH1jQqOAk5QI597p-wxdUq7k6IppQ3_g_x9K-bTZ2FfqkG4izHG0USl3VoyP5_gItPi7m6htKASw6y_L9l1twWAfEdI-uJbdYC4P-3p3fR92tlc_TPBLgpiLe6D4gt8CeUM5jBIsUZkw"
								},
								{
									"key": "scope",
									"value": "openid"
								},
								{
									"key": "nonce",
									"value": "n-0S6_WzA2Mj"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{logoutEndpoint}}",
							"host": [
								"{{logoutEndpoint}}"
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Case - Nominal - Encrypted Request Object",
			"item": [
				{
					"name": "Generate token for DCR client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Has an access_token\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body).to.have.property('access_token');",
									"    pm.expect(body.scope).to.eql('dcr_admin');",
									"    ",
									"    pm.environment.set('access_token', body.access_token);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "{{clientSecret}}",
									"type": "string"
								},
								{
									"key": "username",
									"value": "{{clientId}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "dcr_admin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{tokenEndpoint}}",
							"host": [
								"{{tokenEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Register new client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Has default attributes\", function () {",
									"    var body = pm.response.json();",
									"    pm.expect(body.client_name).to.eql('client_rs256');",
									"",
									"    pm.expect(body).to.have.property('client_id');",
									"    pm.expect(body).to.have.property('client_secret');",
									"    pm.expect(body.request_object_signing_alg).to.eql('RS256');",
									"    ",
									"    pm.environment.set('ro_client_id', body.client_id);",
									"    ",
									"    pm.environment.set('registrationAccessToken', body.registration_access_token);",
									"    pm.environment.set('registrationClientUri', body.registration_client_uri);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 6000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"type": "text",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{access_token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"client_name\": \"client_rs256\",\n    \"redirect_uris\": [\n        \"https://op-test:60001/authz_cb\",\n        \"https://op-test-from-query-param:60001/authz_cb\"\n    ],\n    \"application_type\": \"web\",\n    \"contacts\": [\n        \"roland@example.com\"\n    ],\n    \"response_types\": [\n        \"code\",\n        \"token\",\n        \"id_token\"\n    ],\n    \"grant_types\": [\n        \"authorization_code\",\n        \"implicit\",\n        \"password\"\n    ],\n    \"scope\": \"openid\",\n    \"post_logout_redirect_uris\": [\n        \"https://op-test:60001/logout\"\n    ],\n    \"token_endpoint_auth_method\": \"client_secret_basic\",\n    \"request_object_signing_alg\": \"RS256\",\n    \"jwks\": {\n        \"keys\": [\n        \t{\n            \t\"use\": \"sig\",\n                \"kid\": \"rsa-signature\",\n                \"kty\": \"RSA\",\n                \"e\": \"AQAB\",\n                \"n\": \"4-iLfs52Ta-7s3W_X4-E-f8SwigNhOqigF0Mjoce8mWTQGjS9U1kOuSJKnS9c4gf5vZhBB8iGkufMDvl5nwB0JgcihG6QUiN1NT8WPasJLjRTYQmJNCIYBac0oSZfHIUq8C4kmbFbWqXdp3uB-0l9qalD_HlckBt6lJ4VEb-ntbDpWgQnSxtRDzPZgH_kqJ3sNGnXnd5uNcG1W9v0IC-Wz1-kZ1eFM9-HqfnhGLr4yOr1sSeRQTJUaT12ixSKwn7qBJvnSSUlevIao-Zje2wnvTGVAgsEIuGulw0KWH9hLnYecyTPf3YR7v9sv8ff1qpn0LOmOWOfXYvXqteEcdh9w\"\n            },\n            {\n            \t\"use\": \"enc\",\n                \"kid\": \"rsa-encryption\",\n                \"p\": \"-zZKtw85xX7NrqjsLHsRzSGylxQzgxktOByhljdb9_1S5C-kSZXALMDpuAL1HthknlE7ij3LyJRkyGlR9qbw7dkK5QIypgnOkqALe01hMPSzMChM5c3lK-Kfkj6pk4UM5yduUPWuBOjTr4fuRX1bNFYGnMJN8tDTSqqyGNy4BSU\",\n                \"kty\": \"RSA\",\n                \"q\": \"6ECM2JcOO44V70A1WT043FjeuqmwGlJ64YSMUjRzO3UV6WFQmyVWM0ipmjo8zbfS3GX4F61XrUpRKYVZ5_uUR6I7-MMCPq5Q0JlA9z_fy8Y-_EAQW4bPd9g-TNHt4P5xOhhUmOs_H1zE6T4n8AeoPF0BmwH1OAtM0DV4YROCNes\",\n                \"d\": \"xDs5wJksK3-f8cj0WedM66PAFwQ9f7A28qcrZJza_IKQ4uhem29jWYHkyHVzmcIfFdIVfmMADfwGuJUaQfWL6nrON-NDp2o9FH--NytM1OF89W1PGmuiwHk31drt_MSNH8T0JrnuS2N3vl4E0TZTdafOf4gbst_ew972VDo8ia1oyS8Km4nZ014sygTNZj4sA3IpR_WHvb0l59R0KzLjE83uCU8GDUbiq-vpDD8X1-Id-bvwS8NDArbhfShAUc9ggrlUfcSWfDa8-kmDj4Uj7rJ-rPeg3NMM6EdyJcJdbH5qKMKg3MzA8QZgo8t3imEHVf6sV7Dqb8OaKcH4qxrJ4Q\",\n                \"e\": \"AQAB\",\n                \"qi\": \"1F7jHwhzoqGO2l0oa6zG5SCqPJhgM9q9KdKf5_OgHtNpi8e_H3QmKzq09yfDw87Vi1Z6OzAh5cUNM9RFLjsOjlE6z-le2G4vlb2rALO2GsaQVtf85b3yQjC8yq-IO4GOTbcgFNYuqe8yFcnLCWMAucDew4fy2cFNUY90-JXG87o\",\n                \"dp\": \"elqHKYIQ8VBBfcBox4Fpui-ffFYqgL_SdnH7gd6UvMR1iw5pRi3Z2_JZ43YNTWi4GSQXi81tY9RjAfnKIghNcIs18zSO1rAQHPo2nWei3uVQITR_v6344NcQQXqjvWYgUrWx1VzT1TBRaj0aoF3d_i-oKNG6hXmQb92TwOg_-ME\",\n                \"dq\": \"IX4lkZp_D_GWkjEVQHBGwegC_rI31iPs2pbN0ZEEyR9CcKx6_lStEKo64yXg3N3Uh7ogw_FYgoIEIFO9ummaYZYwxdgBe96RgvOG3eEVOgK11JS8hyZyxtqlaVig0GCBHZqioIbUTIaJUwWGpuPDzCixcZQfs9xVUHVVjdJNZc8\",\n                \"n\": \"4-iLfs52Ta-7s3W_X4-E-f8SwigNhOqigF0Mjoce8mWTQGjS9U1kOuSJKnS9c4gf5vZhBB8iGkufMDvl5nwB0JgcihG6QUiN1NT8WPasJLjRTYQmJNCIYBac0oSZfHIUq8C4kmbFbWqXdp3uB-0l9qalD_HlckBt6lJ4VEb-ntbDpWgQnSxtRDzPZgH_kqJ3sNGnXnd5uNcG1W9v0IC-Wz1-kZ1eFM9-HqfnhGLr4yOr1sSeRQTJUaT12ixSKwn7qBJvnSSUlevIao-Zje2wnvTGVAgsEIuGulw0KWH9hLnYecyTPf3YR7v9sv8ff1qpn0LOmOWOfXYvXqteEcdh9w\"\n            }\n        ]\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{registrationEndpoint}}",
							"host": [
								"{{registrationEndpoint}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Invalid Request Object",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should be a location error\", function() {",
									"    var location = postman.getResponseHeader('Location');",
									"    let domain = pm.environment.get(\"domainHrid\");",
									"    ",
									"    tests['Redirect to default error page (invalid redirect_uri)'] = location.startsWith(pm.environment.get('gateway_url') + '/' + domain + '/oauth/error');",
									"    tests['Contains an error query-parameter'] = location.includes('error=invalid_request_object');",
									"    tests['Contains an error description query-parameter'] = location.includes('error_description=Malformed+request+object');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=http://unknown-redirect-uri/&state=1234-5678-9876&request=eyJjdHkiOiJKV1QiLCJlbmMiOiJBMsdsdsdsdsdsdsdsdsdjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.Q8YdOlXu9-hdrokTnaYHyTyuRoBGIVde7Qp-jjP_UxKbZS3v_9FxJPqUuoDI-wWTfIR3Wq3VGYhBzcR3B2HZGyNlJIJ1LXNODzFXbNwWX1eW3LJhbgsqPNirwUy0YkxTjDVwj5JZoBIWRy8jGnwxNCariJlrKzcxvCWpLa64XPSm4GhmtcKLSbGm6YIUPZuj_xqse3PQdDs_4gGifq4Ed3_hURHL0j4ihK7Z-Uwh5vueYu8oF553rryW2ZyFUpRKULazpF7aj5NJpb_GLeYKP3wxG5BjtFeLPaNHIZdolJsqbRAq-NFiYy8UUIyOy60pk6JElApexchjBnMk1f04vA.LKb0taFx1TqLCfVp.1IoGyozBGF40N_h1ipetBbcvfDHI_YYIeh6cvFt_tk9K3Qx7Dv_ZfQHLhox1CwA0WcNEj7GFWZzFpZ0I4YWORW17J54PQ4bzuFNP_0mpuI7dFBO8fyMZHRr7UaFrzV1_sAQzXFHxGuZTzRG4L0uRNUd5H_pH7RM99i-rFwLUGEYNQBm2SG9118qQmNU9Ia2gafIsxjc9A3vsQmlnv2JfH-JBWYoDGSwEw6o0CjbCIzjkKzOQG6dosPoaKThL3WxRC72UY08qD_JsI8NynVEq--IhOnxpj2QSPXhcYSACZKbiQ6ARlx-mU524hb6jskEyUvukLpGkGfrTHmAtjlSo1NN1SjF5sS_MORGEmDorG0_DZkrvMpFnXO008Y8po-7epgl4jSCcpUFG4c96JWi7FkuF5vBXztjzIMXcH0GwVmlpLnMmgYgzAK3SRswgOzQXz5h90IDj90BCMXz9VoEf1llsZ50ezc9dMKYzsimNscApvC99py0j89R3lVTeq0vaSwU2g-egi8_7sLsPtuPzU9feh99HzILLi8wcxr3_BKgL_zOjBU5D2ds-yu8TgIbo2ifjDPPKKwCdi2yQA30XPxT7U2_ofcRFKbO8lJvnuh2Pje5ZmtKgXRZKl6AFPQHC2tpsN-m1e_O1DYPrQPAzyV8g3szgTY300rLx0pV-thSTI5frnV8kFmXzVQolzZAcd1_o7Y-TMu9JBWAeuA.vx3kYTK7lT1ZwI4xLZq99A&scope=openid&nonce=n-0S6_WzA2Mj",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "http://unknown-redirect-uri/"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "eyJjdHkiOiJKV1QiLCJlbmMiOiJBMsdsdsdsdsdsdsdsdsdjU2R0NNIiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.Q8YdOlXu9-hdrokTnaYHyTyuRoBGIVde7Qp-jjP_UxKbZS3v_9FxJPqUuoDI-wWTfIR3Wq3VGYhBzcR3B2HZGyNlJIJ1LXNODzFXbNwWX1eW3LJhbgsqPNirwUy0YkxTjDVwj5JZoBIWRy8jGnwxNCariJlrKzcxvCWpLa64XPSm4GhmtcKLSbGm6YIUPZuj_xqse3PQdDs_4gGifq4Ed3_hURHL0j4ihK7Z-Uwh5vueYu8oF553rryW2ZyFUpRKULazpF7aj5NJpb_GLeYKP3wxG5BjtFeLPaNHIZdolJsqbRAq-NFiYy8UUIyOy60pk6JElApexchjBnMk1f04vA.LKb0taFx1TqLCfVp.1IoGyozBGF40N_h1ipetBbcvfDHI_YYIeh6cvFt_tk9K3Qx7Dv_ZfQHLhox1CwA0WcNEj7GFWZzFpZ0I4YWORW17J54PQ4bzuFNP_0mpuI7dFBO8fyMZHRr7UaFrzV1_sAQzXFHxGuZTzRG4L0uRNUd5H_pH7RM99i-rFwLUGEYNQBm2SG9118qQmNU9Ia2gafIsxjc9A3vsQmlnv2JfH-JBWYoDGSwEw6o0CjbCIzjkKzOQG6dosPoaKThL3WxRC72UY08qD_JsI8NynVEq--IhOnxpj2QSPXhcYSACZKbiQ6ARlx-mU524hb6jskEyUvukLpGkGfrTHmAtjlSo1NN1SjF5sS_MORGEmDorG0_DZkrvMpFnXO008Y8po-7epgl4jSCcpUFG4c96JWi7FkuF5vBXztjzIMXcH0GwVmlpLnMmgYgzAK3SRswgOzQXz5h90IDj90BCMXz9VoEf1llsZ50ezc9dMKYzsimNscApvC99py0j89R3lVTeq0vaSwU2g-egi8_7sLsPtuPzU9feh99HzILLi8wcxr3_BKgL_zOjBU5D2ds-yu8TgIbo2ifjDPPKKwCdi2yQA30XPxT7U2_ofcRFKbO8lJvnuh2Pje5ZmtKgXRZKl6AFPQHC2tpsN-m1e_O1DYPrQPAzyV8g3szgTY300rLx0pV-thSTI5frnV8kFmXzVQolzZAcd1_o7Y-TMu9JBWAeuA.vx3kYTK7lT1ZwI4xLZq99A"
								},
								{
									"key": "scope",
									"value": "openid"
								},
								{
									"key": "nonce",
									"value": "n-0S6_WzA2Mj"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Do not override state and nonce",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"pm.test(\"Should redirect to login\", function() {",
									"    var location = postman.getResponseHeader('Location');",
									"    let domain = pm.environment.get(\"domainHrid\");",
									"    ",
									"    tests['Redirect to login page with client_id'] = location.includes(pm.environment.get('gateway_url') + '/' + domain + '/login') && location.includes('client_id=' + pm.environment.get('ro_client_id'));",
									"    ",
									"    pm.environment.set('redirection', location);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=https://op-test-from-query-param:60001/authz_cb&state=1234-5678-9876&request=eyJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.R2qPjURyi8NCdkn30k6c5EtrB5D1pSmCFWHtAzQwlCmMfMfWz_VWCyjdCmkET9itOxfgwCLU1VudpyfCGeLyqEtynYDMep0WAiMUwv6dXltBEwRPOR5m3N5kRQi21Mz4BxE0X9-N9xLXUeijOv1Wqpu5OSYrV4MKEjjO3HgYmq5yualnSTjLnUXnbaDbEcrACTxKpwlAt-7PNSsvSyQxMcFwu1pIYRNO3jUDPGhq9WTq-1HNUUbc7rxeT07xmlwuOu-jkFhn6uL7Lfonhoxsey6TqEWdxiBr13h2cGoyPKM_fTkzhA6UNBnWhN2weC8mk60dhh7nTaxQk8ju8jiPgg.oPepurOABjkd2H_JN7ng7A.CgBT5YD0QkohRsU55Mqxlu6QJAqCypXZqUYwL97uYPtIclY_DoYdQwMWWQYOwRvwDdXzAyqSak3bCsvmFh2IRk-LV9mdJrHOwNu72MjUY5q-UAS82lYo08qn32rLR6iRrojtbMaH6n4wElgCfACxFpC5g89JznXhCfs_7D-3wnt0LnCOvV0a0E032BbuXLL596IWhcwhJGOdVtLK-Ea9G0P-Jw6nujbe6B1JHTP7lbM4yfIVdlUyLN7zP0_TRXB9s5THLPuc3_KHZasbRbLdfWQyljomt0Zp3XOXdKgFkzQ8dLr5pUhl-OFjQn01o7V42YichHt95b99fWZj88D5pqEpOcy_9zFV7PhzwJg34c0if7DYZnXbfk6RfQg8tp5wpIeSBQbXhB9wKNv2VGWS5tD5GqrY2hhgv0H9An4WDtt3S4JuGk9xWt2rCHNRTgjvkXR00STNgooCDTzSk8soII7QsZNuRCU0MUNb3LYw-_vluTU7UzhYrGeK0y6FOyNaTdnf2oQVgVAUSArXFTWtTBv37mXUwT5a0YEkywZJ9AJJkuFTPF7aUMLjvh4Ry_XbCg4zFV6vjM03QnF3mctRe8FwJnDqgBpRmCOUlYd-vY_ecMNxc4J0_PUem2MOUbBi3dmFyLA4NI_i0BxcRpxWCr_nh7MxzJcYgMh_Gmg_kkSJd8rAgTIjoE7mc11FU6X_hF7INsKnSr4IL-4wE5OeEQ.Lw1oia2hUbgZQ9Zj3H9FVA&scope=openid&nonce=n-0S6_WzA2Mj",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "https://op-test-from-query-param:60001/authz_cb"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "eyJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.R2qPjURyi8NCdkn30k6c5EtrB5D1pSmCFWHtAzQwlCmMfMfWz_VWCyjdCmkET9itOxfgwCLU1VudpyfCGeLyqEtynYDMep0WAiMUwv6dXltBEwRPOR5m3N5kRQi21Mz4BxE0X9-N9xLXUeijOv1Wqpu5OSYrV4MKEjjO3HgYmq5yualnSTjLnUXnbaDbEcrACTxKpwlAt-7PNSsvSyQxMcFwu1pIYRNO3jUDPGhq9WTq-1HNUUbc7rxeT07xmlwuOu-jkFhn6uL7Lfonhoxsey6TqEWdxiBr13h2cGoyPKM_fTkzhA6UNBnWhN2weC8mk60dhh7nTaxQk8ju8jiPgg.oPepurOABjkd2H_JN7ng7A.CgBT5YD0QkohRsU55Mqxlu6QJAqCypXZqUYwL97uYPtIclY_DoYdQwMWWQYOwRvwDdXzAyqSak3bCsvmFh2IRk-LV9mdJrHOwNu72MjUY5q-UAS82lYo08qn32rLR6iRrojtbMaH6n4wElgCfACxFpC5g89JznXhCfs_7D-3wnt0LnCOvV0a0E032BbuXLL596IWhcwhJGOdVtLK-Ea9G0P-Jw6nujbe6B1JHTP7lbM4yfIVdlUyLN7zP0_TRXB9s5THLPuc3_KHZasbRbLdfWQyljomt0Zp3XOXdKgFkzQ8dLr5pUhl-OFjQn01o7V42YichHt95b99fWZj88D5pqEpOcy_9zFV7PhzwJg34c0if7DYZnXbfk6RfQg8tp5wpIeSBQbXhB9wKNv2VGWS5tD5GqrY2hhgv0H9An4WDtt3S4JuGk9xWt2rCHNRTgjvkXR00STNgooCDTzSk8soII7QsZNuRCU0MUNb3LYw-_vluTU7UzhYrGeK0y6FOyNaTdnf2oQVgVAUSArXFTWtTBv37mXUwT5a0YEkywZJ9AJJkuFTPF7aUMLjvh4Ry_XbCg4zFV6vjM03QnF3mctRe8FwJnDqgBpRmCOUlYd-vY_ecMNxc4J0_PUem2MOUbBi3dmFyLA4NI_i0BxcRpxWCr_nh7MxzJcYgMh_Gmg_kkSJd8rAgTIjoE7mc11FU6X_hF7INsKnSr4IL-4wE5OeEQ.Lw1oia2hUbgZQ9Zj3H9FVA"
								},
								{
									"key": "scope",
									"value": "openid"
								},
								{
									"key": "nonce",
									"value": "n-0S6_WzA2Mj"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Redirect to login form",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Should be ok\", function () {",
									"    pm.response.to.be.ok;",
									"    ",
									"    // Extract the XSRF token to send it with the next request.",
									"    var responseHTML = cheerio.load(pm.response.text());",
									"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
									"    const action = responseHTML('form').attr('action');",
									"    pm.environment.set('xsrf', xsrfToken);",
									"    pm.environment.set('action', action);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Post login form",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "X-XSRF-TOKEN",
									"value": "{{xsrf}}",
									"type": "text"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}",
									"type": "text"
								},
								{
									"key": "username",
									"value": "user",
									"type": "text"
								},
								{
									"key": "password",
									"value": "#CoMpL3X-P@SsW0Rd",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{action}}",
							"host": [
								"{{action}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Redirect after login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Redirect to consent",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Should be ok\", function () {",
									"    pm.response.to.be.ok;",
									"    ",
									"    // Extract the XSRF token to send it with the next request.",
									"    var responseHTML = cheerio.load(pm.response.text());",
									"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
									"    const action = responseHTML('form').attr('action');",
									"    pm.environment.set('xsrf', xsrfToken);",
									"    pm.environment.set('action', action);",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Post consent form",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "X-XSRF-TOKEN",
									"value": "{{xsrf}}",
									"type": "text"
								},
								{
									"key": "scope.openid",
									"value": "true",
									"type": "text"
								},
								{
									"key": "user_oauth_approval",
									"value": "true",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{action}}",
							"host": [
								"{{action}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Redirect after consent",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected to client app\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"   const location = postman.getResponseHeader(\"Location\");",
									"",
									"    // State must come from request params",
									"    tests['Contains the request object state'] = location.includes('state=override-state');",
									"    ",
									"    // Redirect uri must match the one specified in request object.",
									"    tests['Redirect to query param redirect_uri'] = location.includes('https://op-test-from-query-param:60001/authz_cb');",
									"",
									"    // Redirect uri must match the one specified in query params.",
									"    tests['Contains a code'] = location.includes('code=');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{redirection}}",
							"host": [
								"{{redirection}}"
							]
						},
						"description": "The client does not have a redirect_uri define"
					},
					"response": []
				},
				{
					"name": "Use redirect_uri from request_object",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 302\", function () {",
									"    pm.response.to.have.status(302);",
									"});",
									"",
									"pm.test(\"Should be redirected\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"});",
									"",
									"",
									"pm.test(\"Should be redirected to client app\", function () {",
									"    pm.response.to.be.redirection;",
									"    pm.response.to.have.header('Location');",
									"",
									"   const location = postman.getResponseHeader(\"Location\");",
									"",
									"    // State must come from request object",
									"    tests['Contains the request object state'] = location.includes('state=1234-5678-9876');",
									"    ",
									"    // Redirect uri must match the one specified in query params.",
									"    tests['Redirect to query param redirect_uri'] = location.includes('https://op-test:60001/authz_cb');",
									"",
									"    // Redirect uri must match the one specified in query params.",
									"    tests['Contains a code'] = location.includes('code=');",
									"});"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic"
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{ro_client_id}}&redirect_uri=http://unknown_but_overriden_uri/&state=1234-5678-9876&request=eyJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.VTdmd_ScLpsGB_pAZAZHiiUG8K3I9Rs9Y1dVZCog9uDtg_8dCoH-tDvt-rdSM1dYEfD0_nkhwlThaRsHqSKGlBjO6F5u15bBlFI7-pwyG11zeX82b6PQic_AEloKTRDwY1bovPUPuNgD-Qi-Txp5xZEYMw3etnqTLc7lFHMjE6SAdgDu6q-yzJLwN5WYB5s_BAczG1NwnL6x6QfNTzARABY76seXEOrq0EvD0Y4-XvBw06o7Ogk19qXihGfDFn1hGXZYSvP7xBWyc0iKTXFep7ma_uFO6sq9WQ6bZceNLgNfP1LJ-xjiiVbMdUw6eA_t-uRbnNfYzDYN0mipra_hWA.IKY3Bs5Bj7vc4HqnaIelbg.aAN4Z3Rwg0XikvG9Vf-CFOr__jCSYYXkDcCrnpGLTWXrQpwjJt_5MbQguvCIh5pp-B7Yr8MUw6YY27pWcXLsIwue5fqC4VcTznXWIFKv3tKxLhZSp_Z47UTDNRKDuNZXNp6IBz6G_WKMLhWmu-UfCnWSa4Zmg5vXcwZfTa14eO-Xc1zATUa8Tna1hosutApIICvLyEgtZAexwQrxDPSluYqlF68i8rA1iLtzsBzS9RLzVSSvTgDoTSBobm4lTYIsc7cQi8QdQF_x4Yx5adKptAvfHQpmcUeBWpw7X37uKV7bkMQJ_uKUr0KqcAZNPMEHb4JvQYNXWrGJWxy-g1VsRRnmFP179R0APwiXqmUHJ3kiDBv3LUOl7k5vFv80aeONBva0lKtHLjYxFwQGfDQWgLw8VIGaESQGNeaifOjHBAKDzMor_DAxgcVKwS3soTecf1Tf_gPB1MvC0zAATjlCtf6nR0CB_v4T8VU3uAhytd77OdgfPML9UT-JwUEztFZQLs8MfZ1A-Y-F_gcw1KLTb4zGa46rW5kolEpWEfn-KK4FoxoDzS15n9BEK4gHw6huX9DWmcTiJeCDBOOfGYK9wU2BsbTED3VlPyEAC6NEYn_i8lqSWONYfozd54n-4STaQ5YGd38EGqoq_vNm3tbihYTxFIXcL9nlrbooseSRJ1Mq3S8BLbH9AyGGJkI4j--V3FMbjBXa5LKPSrkhmFaKuw.dRRCDgoIp2UEudWVY18ZuA&scope=openid&nonce=n-0S6_WzA2Mj",
							"host": [
								"{{authorizationEndpoint}}"
							],
							"query": [
								{
									"key": "response_type",
									"value": "code"
								},
								{
									"key": "client_id",
									"value": "{{ro_client_id}}"
								},
								{
									"key": "redirect_uri",
									"value": "http://unknown_but_overriden_uri/"
								},
								{
									"key": "state",
									"value": "1234-5678-9876"
								},
								{
									"key": "request",
									"value": "eyJlbmMiOiJBMTI4Q0JDLUhTMjU2IiwiYWxnIjoiUlNBLU9BRVAtMjU2In0.VTdmd_ScLpsGB_pAZAZHiiUG8K3I9Rs9Y1dVZCog9uDtg_8dCoH-tDvt-rdSM1dYEfD0_nkhwlThaRsHqSKGlBjO6F5u15bBlFI7-pwyG11zeX82b6PQic_AEloKTRDwY1bovPUPuNgD-Qi-Txp5xZEYMw3etnqTLc7lFHMjE6SAdgDu6q-yzJLwN5WYB5s_BAczG1NwnL6x6QfNTzARABY76seXEOrq0EvD0Y4-XvBw06o7Ogk19qXihGfDFn1hGXZYSvP7xBWyc0iKTXFep7ma_uFO6sq9WQ6bZceNLgNfP1LJ-xjiiVbMdUw6eA_t-uRbnNfYzDYN0mipra_hWA.IKY3Bs5Bj7vc4HqnaIelbg.aAN4Z3Rwg0XikvG9Vf-CFOr__jCSYYXkDcCrnpGLTWXrQpwjJt_5MbQguvCIh5pp-B7Yr8MUw6YY27pWcXLsIwue5fqC4VcTznXWIFKv3tKxLhZSp_Z47UTDNRKDuNZXNp6IBz6G_WKMLhWmu-UfCnWSa4Zmg5vXcwZfTa14eO-Xc1zATUa8Tna1hosutApIICvLyEgtZAexwQrxDPSluYqlF68i8rA1iLtzsBzS9RLzVSSvTgDoTSBobm4lTYIsc7cQi8QdQF_x4Yx5adKptAvfHQpmcUeBWpw7X37uKV7bkMQJ_uKUr0KqcAZNPMEHb4JvQYNXWrGJWxy-g1VsRRnmFP179R0APwiXqmUHJ3kiDBv3LUOl7k5vFv80aeONBva0lKtHLjYxFwQGfDQWgLw8VIGaESQGNeaifOjHBAKDzMor_DAxgcVKwS3soTecf1Tf_gPB1MvC0zAATjlCtf6nR0CB_v4T8VU3uAhytd77OdgfPML9UT-JwUEztFZQLs8MfZ1A-Y-F_gcw1KLTb4zGa46rW5kolEpWEfn-KK4FoxoDzS15n9BEK4gHw6huX9DWmcTiJeCDBOOfGYK9wU2BsbTED3VlPyEAC6NEYn_i8lqSWONYfozd54n-4STaQ5YGd38EGqoq_vNm3tbihYTxFIXcL9nlrbooseSRJ1Mq3S8BLbH9AyGGJkI4j--V3FMbjBXa5LKPSrkhmFaKuw.dRRCDgoIp2UEudWVY18ZuA"
								},
								{
									"key": "scope",
									"value": "openid"
								},
								{
									"key": "nonce",
									"value": "n-0S6_WzA2Mj"
								}
							]
						}
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "Delete domain",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {",
							"    pm.response.to.have.status(204);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
					"host": [
						"{{management_url}}"
					],
					"path": [
						"management",
						"organizations",
						"{{defaultOrganizationId}}",
						"environments",
						"{{defaultEnvironmentId}}",
						"domains",
						"{{domain}}"
					]
				}
			},
			"response": []
		}
	]
}
