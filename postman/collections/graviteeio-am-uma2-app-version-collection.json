{
	"info": {
		"_postman_id": "c8334b83-058d-46ed-925c-9818a776be33",
		"name": "Gravitee.io - AM - UMA 2.0 - app version",
		"description": "Test openid connect discovery specifications: https://openid.net/specs/openid-connect-discovery-1_0.html",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Prepare",
			"item": [
				{
					"name": "Generate admin token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var token = JSON.parse(responseBody);",
									"pm.environment.set('token', token.access_token);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW5hZG1pbg=="
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "password",
									"value": "adminadmin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{management_url}}/management/auth/token",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"auth",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create uma 2.0  domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"pm.environment.set('domain', jsonData.id);",
									"pm.environment.set('domainHrid', jsonData.hrid);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"uma2_postman\", \n\t\"description\": \"test user-managed access specifications\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete default identity provider",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"password\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities/default-idp-{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities",
								"default-idp-{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create in-memory IDP",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var body = JSON.parse(responseBody);",
									"pm.environment.set('idp.inmemory', body.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"Alice\\\",\\\"lastname\\\":\\\"Doe\\\",\\\"username\\\":\\\"alice\\\",\\\"password\\\":\\\"password\\\"},{\\\"firstname\\\":\\\"Bob\\\",\\\"lastname\\\":\\\"Doe\\\",\\\"username\\\":\\\"bob\\\",\\\"email\\\":\\\"bob.doe@mail.com\\\",\\\"password\\\":\\\"password\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create RS application",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"",
									"pm.test(\"Saving credentials\", function () {",
									"    let body = JSON.parse(responseBody);",
									"",
									"    let client_id = body.settings.oauth.clientId;",
									"    let secret = body.settings.oauth.clientSecret;",
									"    let authentication = btoa(client_id + \":\" + secret);  ",
									"",
									"    //Save fields",
									"    pm.environment.set('rs_app', body.id);",
									"    pm.environment.set('rs_client_id', client_id);",
									"    pm.environment.set('rs_client_secret', secret);",
									"    pm.environment.set('rs_client_authentication', authentication);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"RS-client\",\n  \"type\": \"RESOURCE_SERVER\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications"
							]
						}
					},
					"response": []
				},
				{
					"name": "Configure RS application",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Check grant\", function () {",
									"    let body = JSON.parse(responseBody);",
									"    pm.expect(body.settings.oauth.grantTypes).to.eql([\"password\",\"client_credentials\"]);",
									"    pm.expect(body.settings.oauth.scopes).to.eql([\"uma_protection\"]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"identities\": [\n    \"{{idp.inmemory}}\"\n  ],\n  \"settings\": {\n  \t\"oauth\": {\n  \t\t\"scopes\": [\"uma_protection\"],\n  \t\t\"redirectUris\": [],\n\t\t\"grantTypes\": [\"password\"]\n\t}\n  }\n}\n"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications/{{rs_app}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications",
								"{{rs_app}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create RqP application",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"",
									"pm.test(\"Saving credentials\", function () {",
									"    let body = JSON.parse(responseBody);",
									"",
									"    let client_id = body.settings.oauth.clientId;",
									"    let secret = body.settings.oauth.clientSecret;",
									"    let authentication = btoa(client_id + \":\" + secret);  ",
									"",
									"    //Save fields",
									"    pm.environment.set('rqp_app', body.id);",
									"    pm.environment.set('rqp_client_id', client_id);",
									"    pm.environment.set('rqp_client_secret', secret);",
									"    pm.environment.set('rqp_client_authentication', authentication);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"RQP-client\",\n  \"type\": \"WEB\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications"
							]
						}
					},
					"response": []
				},
				{
					"name": "Configure RqP application",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Check grant\", function () {",
									"    let body = JSON.parse(responseBody);",
									"    pm.expect(body.settings.oauth.grantTypes).to.have.members([\"password\",\"refresh_token\",\"urn:ietf:params:oauth:grant-type:uma-ticket\"]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"identities\": [\n    \"{{idp.inmemory}}\"\n  ],\n  \"settings\": {\n  \t\"oauth\": {\n  \t\t\"redirectUris\": [],\n\t\t\"grantTypes\": [\"password\",\"refresh_token\",\"urn:ietf:params:oauth:grant-type:uma-ticket\"],\n\t\t\"scopes\": [\"openid\",\"profile\",\"email\",\"phone\",\"address\"]\n\t}\n  }\n}\n"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications/{{rqp_app}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications",
								"{{rqp_app}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Start domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// wait for sync process",
									"setTimeout(function () { }, 10000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"enabled\": true\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "UMA_2.0",
			"item": [
				{
					"name": "Case - UMA disabled",
					"item": [
						{
							"name": "Discovery",
							"item": [
								{
									"name": "Gravitee AM .well-known",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Check discovery endpoints\", function () {",
													"    pm.response.to.be.header('Content-Type', 'application/json');",
													"    var body = pm.response.json();",
													"    ",
													"    pm.expect(body).to.have.property(\"openid-configuration\");",
													"    pm.expect(body).to.not.have.property(\"uma2-configuration\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{gateway_url}}/{{domainHrid}}/.well-known",
											"host": [
												"{{gateway_url}}"
											],
											"path": [
												"{{domainHrid}}",
												".well-known"
											]
										}
									},
									"response": []
								},
								{
									"name": "Gravitee UMA .well-known disabled",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 404\", function () {",
													"    pm.response.to.have.status(404);",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{gateway_url}}/{{domainHrid}}/uma/.well-known/uma2-configuration",
											"host": [
												"{{gateway_url}}"
											],
											"path": [
												"{{domainHrid}}",
												"uma",
												".well-known",
												"uma2-configuration"
											]
										}
									},
									"response": []
								},
								{
									"name": "Fetch Token Endpoint",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Check uma 2.0 discovery endpoint\", function () {",
													"    pm.response.to.be.header('Content-Type', 'application/json');",
													"    var body = pm.response.json();",
													"",
													"    //Oauth 2.0 endpoints",
													"    pm.expect(body).to.have.property(\"token_endpoint\");",
													"    pm.environment.set('oidcTokenEndpoint', body.token_endpoint);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{gateway_url}}/{{domainHrid}}/oidc/.well-known/openid-configuration",
											"host": [
												"{{gateway_url}}"
											],
											"path": [
												"{{domainHrid}}",
												"oidc",
												".well-known",
												"openid-configuration"
											]
										}
									},
									"response": []
								},
								{
									"name": "Token endpoint - Unsupported UMA grant",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"//Grant type must not be supported when UMA is disabled",
													"pm.test(\"Check grant type is not supported\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"    ",
													"    pm.expect(body.error).to.eql(\"unsupported_grant_type\");",
													"    pm.expect(body.error_description).to.eql(\"Unsupported grant type: urn:ietf:params:oauth:grant-type:uma-ticket\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"type": "text",
												"value": "Basic {{rs_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "must_fail_before",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{oidcTokenEndpoint}}",
											"host": [
												"{{oidcTokenEndpoint}}"
											]
										}
									},
									"response": []
								}
							]
						}
					]
				},
				{
					"name": "Enable UMA 2.0",
					"item": [
						{
							"name": "Enable UMA",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"UMA enabled for domain\", function () {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.uma.enabled).to.eql(true);",
											"});",
											"",
											"// wait for sync process",
											"setTimeout(function () { }, 10000);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "PATCH",
								"header": [
									{
										"key": "Authorization",
										"type": "text",
										"value": "Bearer {{token}}"
									},
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"uma\": {\n    \"enabled\": true\n  }\n}"
								},
								"url": {
									"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
									"host": [
										"{{management_url}}"
									],
									"path": [
										"management",
										"organizations",
										"{{defaultOrganizationId}}",
										"environments",
										"{{defaultEnvironmentId}}",
										"domains",
										"{{domain}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Gravitee AM .well-known",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"Check uma is enabled\", function () {",
											"    pm.response.to.be.header('Content-Type', 'application/json');",
											"    let body = pm.response.json();",
											"    let expected_endpoint = pm.environment.get('gateway_url') + \"/\" + pm.environment.get('domainHrid') + \"/uma/.well-known/uma2-configuration\";",
											"",
											"    pm.expect(body).to.have.property(\"openid-configuration\");",
											"    pm.expect(body).to.have.property(\"uma2-configuration\");",
											"",
											"    pm.expect(body['uma2-configuration']).to.eql(expected_endpoint);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/{{domainHrid}}/.well-known",
									"host": [
										"{{gateway_url}}"
									],
									"path": [
										"{{domainHrid}}",
										".well-known"
									]
								}
							},
							"response": []
						},
						{
							"name": "Gravitee UMA .well-known enabled",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"Check uma 2.0 discovery endpoint\", function () {",
											"    pm.response.to.be.header('Content-Type', 'application/json');",
											"    var body = pm.response.json();",
											"",
											"    //Specific uma 2.0 endpoints",
											"    pm.expect(body).to.have.property(\"resource_registration_endpoint\");",
											"    pm.expect(body).to.have.property(\"permission_endpoint\");",
											"    pm.expect(body).to.have.property(\"uma_profiles_supported\");",
											"    pm.expect(body).to.have.property(\"claims_interaction_endpoint\");",
											"    pm.environment.set('resource_registration_endpoint', body.resource_registration_endpoint);",
											"    pm.environment.set('permission_endpoint', body.permission_endpoint);",
											"",
											"    //Check UMA Grant is available",
											"    pm.expect(body.grant_types_supported).to.include('urn:ietf:params:oauth:grant-type:uma-ticket');",
											"",
											"    //Oauth 2.0 endpoints",
											"    pm.expect(body).to.have.property(\"token_endpoint\");",
											"    pm.expect(body).to.have.property(\"introspection_endpoint\");",
											"    pm.environment.set('tokenEndpoint', body.token_endpoint);",
											"    pm.environment.set('introspectionEndpoint', body.introspection_endpoint);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/{{domainHrid}}/uma/.well-known/uma2-configuration",
									"host": [
										"{{gateway_url}}"
									],
									"path": [
										"{{domainHrid}}",
										"uma",
										".well-known",
										"uma2-configuration"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "UMA Protection API",
					"item": [
						{
							"name": "Invalid cases",
							"item": [
								{
									"name": "Not a PAT (Protection Api Token)",
									"item": [
										{
											"name": "Login without UMA scope",
											"item": [
												{
													"name": "Login without - Not PAT",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"    ",
																	"    pm.environment.set('access_token', body.access_token);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "password",
																	"type": "text"
																},
																{
																	"key": "username",
																	"value": "alice",
																	"type": "text"
																},
																{
																	"key": "password",
																	"value": "password",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Resource Registration",
											"item": [
												{
													"name": "Not Authenticated",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 401\", function () {",
																	"    pm.response.to.have.status(401);",
																	"});",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [],
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Not Supported method",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 405\", function () {",
																	"    pm.response.to.have.status(405);",
																	"});",
																	"",
																	"pm.test(\"Check 405 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"    ",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"unsupported_method_type\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "DELETE",
														"header": [],
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Missing scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 403\", function () {",
																	"    pm.response.to.have.status(403);",
																	"});",
																	"",
																	"pm.test(\"Check 403 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"insufficient_scope\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "Authorization",
																"value": "Bearer {{access_token}}",
																"type": "text"
															}
														],
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Permission Ticket",
											"item": [
												{
													"name": "Not Authenticated",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 401\", function () {",
																	"    pm.response.to.have.status(401);",
																	"});",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Content-Type",
																"value": "application/json",
																"type": "text"
															}
														],
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Not Supported method",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 405\", function () {",
																	"    pm.response.to.have.status(405);",
																	"});",
																	"",
																	"pm.test(\"Check 405 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"unsupported_method_type\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "DELETE",
														"header": [],
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Not A Client PAT",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 401\", function () {",
																	"    pm.response.to.have.status(401);",
																	"});",
																	"",
																	"pm.test(\"Check 401 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body).to.have.property(\"error_description\");",
																	"    pm.expect(body.error).to.eql(\"invalid_token\");",
																	"    pm.expect(body.error_description).to.eql(\"The access token was not issued for a Client\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{access_token}}"
															},
															{
																"key": "Content-Type",
																"type": "text",
																"value": "application/json"
															}
														],
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												}
											]
										}
									]
								},
								{
									"name": "With a PAT (Protection Api Token)",
									"item": [
										{
											"name": "Prepare - Login with UMA scope",
											"item": [
												{
													"name": "Alice Login - PAT bearer",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"    pm.expect(body).to.have.property('scope');",
																	"    pm.expect(body.scope).to.eql('uma_protection');",
																	"",
																	"    pm.environment.set('protection_api_token', body.access_token);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rs_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "password",
																	"type": "text"
																},
																{
																	"key": "username",
																	"value": "alice",
																	"type": "text"
																},
																{
																	"key": "password",
																	"value": "password",
																	"type": "text"
																},
																{
																	"key": "scope",
																	"value": "uma_protection",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Resource Registration",
											"item": [
												{
													"name": "Icon Uri malformed",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has a location\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"    pm.expect(body.error_description).to.include(\"Icon uri claim is malformed\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"description\":\"Should fail due to malformed icon_uri\",\n   \"name\":\"Should fail\",\n   \"icon_uri\":\"trigger_malformed_icon_uri\"\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Scope not found",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has a location\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"    pm.expect(body.error_description).to.include(\"Scope [not_found] can not be found.\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_scopes\":[  \n      \"not_found\"\n   ],\n   \"description\":\"Should fail due to missing scope\",\n   \"name\":\"Should fail\"\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Permission Ticket",
											"item": [
												{
													"name": "RS Login - PAT bearer",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"    pm.expect(body).to.have.property('scope');",
																	"    pm.expect(body.scope).to.eql('uma_protection');",
																	"",
																	"    pm.environment.set('rs_pat', body.access_token);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rs_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "client_credentials",
																	"type": "text"
																},
																{
																	"key": "scope",
																	"value": "uma_protection",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Parsing Error",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check 405 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_id_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile:read\",\n\t\t\t\"email:read\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_id_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_id_two}}\",\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request - Invalid Request",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_id\":\"test\",\n   \"resource_scopes\":[  \n      \"valide one\",\n      \"\"\n   ]\n   \n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Extended Permission - Invalid Request",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile:read\",\n\t\t\t\"email:read\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Create Resource",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check headers",
																	"    pm.response.to.have.header(\"Content-Type\");",
																	"    pm.response.to.have.header('Location');",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('_id');",
																	"    pm.expect(body).to.have.property('resource_scopes');",
																	"    ",
																	"    //Save values",
																	"    pm.environment.set('resource_location', pm.response.headers.get('Location'));",
																	"    pm.environment.set('resource_id', body._id);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"description\":\"desc\",\n   \"name\":\"name\"\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request - Invalid resource scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_scope\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_id\":\"{{resource_id}}\",\n   \"resource_scopes\":[\n   \t  \"profile\",\n      \"not found\"\n   ]\n   \n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Delete Resource",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 204\", function () {",
																	"    pm.response.to.have.status(204);",
																	"});",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "DELETE",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"url": {
															"raw": "{{resource_location}}",
															"host": [
																"{{resource_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request - Invalid resource id",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_resource_id\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_id\":\"{{resource_id}}\",\n   \"resource_scopes\":[  \n      \"email\"\n   ]\n   \n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												}
											]
										}
									]
								}
							],
							"description": "Case when user bearer called Protected Access Token (PAT) does not contains uma_protected scope."
						},
						{
							"name": "Nominal case",
							"item": [
								{
									"name": "Prepare - Login with UMA scope",
									"item": [
										{
											"name": "Alice Login - PAT bearer",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.have.property('scope');",
															"    pm.expect(body.scope).to.eql('uma_protection');",
															"",
															"    pm.environment.set('protection_api_token', body.access_token);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rs_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "password",
															"type": "text"
														},
														{
															"key": "username",
															"value": "alice",
															"type": "text"
														},
														{
															"key": "password",
															"value": "password",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "uma_protection",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										}
									]
								},
								{
									"name": "Resource Registration",
									"item": [
										{
											"name": "List",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer {{protection_api_token}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Create",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Has a location\", function () {",
															"    var body = pm.response.json();",
															"    //Check headers",
															"    pm.response.to.have.header(\"Content-Type\");",
															"    pm.response.to.have.header('Location');",
															"    //Check body",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"",
															"    //Save values",
															"    pm.environment.set('resource_location', pm.response.headers.get('Location'));",
															"    pm.environment.set('resource_id', body._id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"phone\"\n   ],\n   \"description\":\"photo1\",\n   \"icon_uri\":\"http://www.example.com/icons/picture.png\",\n   \"name\":\"Photo access\",\n   \"type\":\"http://www.example.com/resource/photo\"\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Get",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Is able to fetch resource_set\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location}}",
													"host": [
														"{{resource_location}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Update",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Is able to update resource_set\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"    pm.expect(body).to.have.property('name');",
															"",
															"    pm.expect(body.name).to.eql('updated');",
															"    pm.expect(body.resource_scopes).to.eql([\"profile\"]);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "PUT",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"name\":\"updated\"\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_location}}",
													"host": [
														"{{resource_location}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "List",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Can find resource_set in list\", function () {",
															"    var body = pm.response.json();",
															"    console.log(body[0]);",
															"    console.log(pm.environment.get('resource_id'));",
															"    pm.expect(body[0]).to.eql(pm.environment.get('resource_id'));",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Delete",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location}}",
													"host": [
														"{{resource_location}}"
													]
												}
											},
											"response": []
										}
									]
								},
								{
									"name": "Resource Access Policies",
									"item": [
										{
											"name": "Create resource",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    var body = pm.response.json();",
															"    pm.response.to.have.status(201);",
															"    pm.environment.set('resource_location', pm.response.headers.get('Location'));",
															"    pm.environment.set('resource_id', body._id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"phone\"\n   ],\n   \"description\":\"photo1\",\n   \"icon_uri\":\"http://www.example.com/icons/picture.png\",\n   \"name\":\"Photo access\",\n   \"type\":\"http://www.example.com/resource/photo\"\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "List policies",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Can find default policy\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body[0]).not.equal(null);",
															"    pm.environment.set('policy_id', body[0]);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer {{protection_api_token}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{resource_location}}/policies",
													"host": [
														"{{resource_location}}"
													],
													"path": [
														"policies"
													]
												}
											},
											"response": []
										},
										{
											"name": "Delete default policy",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location}}/policies/{{policy_id}}",
													"host": [
														"{{resource_location}}"
													],
													"path": [
														"policies",
														"{{policy_id}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Create policy",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Has a location\", function () {",
															"    var body = pm.response.json();",
															"    //Check headers",
															"    pm.response.to.have.header(\"Content-Type\");",
															"    pm.response.to.have.header('Location');",
															"    //Check body",
															"    pm.expect(body).to.have.property('id');",
															"    pm.expect(body).to.have.property('condition');",
															"",
															"    //Save values",
															"    pm.environment.set('policy_location', pm.response.headers.get('Location'));",
															"    pm.environment.set('policy_id', body.id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nresult.state = State.SUCCESS;\"\n\t}\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_location}}/policies",
													"host": [
														"{{resource_location}}"
													],
													"path": [
														"policies"
													]
												}
											},
											"response": []
										},
										{
											"name": "Get policy",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Is able to fetch policy\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('id');",
															"    pm.expect(body).to.have.property('condition');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{policy_location}}",
													"host": [
														"{{policy_location}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Update policy",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Is able to update resource_set\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('id');",
															"    pm.expect(body).to.have.property('name');",
															"    pm.expect(body).to.have.property('condition');",
															"    pm.expect(body.name).to.eql('policy-name-updated');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "PUT",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n\t\"name\": \"policy-name-updated\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nresult.state = State.FAILURE;\"\n\t}\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{policy_location}}",
													"host": [
														"{{policy_location}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "List policies",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Can find policies\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body[0]).to.eql(pm.environment.get('policy_id'));",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location}}/policies",
													"host": [
														"{{resource_location}}"
													],
													"path": [
														"policies"
													]
												}
											},
											"response": []
										},
										{
											"name": "Delete policy",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{policy_location}}",
													"host": [
														"{{policy_location}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Delete resource",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location}}",
													"host": [
														"{{resource_location}}"
													]
												}
											},
											"response": []
										}
									]
								},
								{
									"name": "Permission Ticket",
									"item": [
										{
											"name": "Create New Resource One",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    //Check headers",
															"    pm.response.to.have.header(\"Content-Type\");",
															"    pm.response.to.have.header('Location');",
															"    //Check body",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"",
															"    //Save values",
															"    pm.environment.set('resource_location_one', pm.response.headers.get('Location'));",
															"    pm.environment.set('resource_set_one', body._id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"description\":\"Give access to profile information\",\n   \"icon_uri\": null,\n   \"name\":\"Profile access\",\n   \"type\":null\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "List policies",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Can find default policy\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body[0]).not.equal(null);",
															"    pm.environment.set('policy_id', body[0]);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer {{protection_api_token}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{resource_location_one}}/policies",
													"host": [
														"{{resource_location_one}}"
													],
													"path": [
														"policies"
													]
												}
											},
											"response": []
										},
										{
											"name": "Delete default policy",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location_one}}/policies/{{policy_id}}",
													"host": [
														"{{resource_location_one}}"
													],
													"path": [
														"policies",
														"{{policy_id}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Create New Resource Two",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    //Check headers",
															"    pm.response.to.have.header(\"Content-Type\");",
															"    pm.response.to.have.header('Location');",
															"    //Check body",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"",
															"    //Save values",
															"    pm.environment.set('resource_location_two', pm.response.headers.get('Location'));",
															"    pm.environment.set('resource_set_two', body._id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"phone\",\n      \"email\",\n      \"address\"\n   ],\n   \"description\":\"Phone, email and address access\",\n   \"name\":\"Contact access\"\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "List policies",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Can find default policy\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body[0]).not.equal(null);",
															"    pm.environment.set('policy_id', body[0]);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer {{protection_api_token}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{resource_location_two}}/policies",
													"host": [
														"{{resource_location_two}}"
													],
													"path": [
														"policies"
													]
												}
											},
											"response": []
										},
										{
											"name": "Delete default policy",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location_two}}/policies/{{policy_id}}",
													"host": [
														"{{resource_location_two}}"
													],
													"path": [
														"policies",
														"{{policy_id}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RS Login - PAT bearer",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.have.property('scope');",
															"    pm.expect(body.scope).to.eql('uma_protection');",
															"",
															"    pm.environment.set('rs_pat', body.access_token);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rs_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "client_credentials",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "uma_protection",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer {{rs_pat}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_id\":\"{{resource_set_one}}\",\n   \"resource_scopes\":[  \n      \"profile\"\n   ]\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										}
									]
								}
							]
						}
					]
				},
				{
					"name": "UMA Grant",
					"item": [
						{
							"name": "Prepare",
							"item": [
								{
									"name": "Bob Login - to RqP Client",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Has an access_token\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('access_token');",
													"    pm.expect(body).to.have.property('token_type');",
													"    pm.expect(body.token_type).to.eql('bearer');",
													"    pm.expect(body).to.have.property('expires_in');",
													"    pm.expect(body).to.have.property('scope');",
													"    pm.expect(body.scope).to.eql('openid');",
													"    pm.expect(body).to.have.property('id_token');",
													"",
													"    pm.environment.set('bob_id_token', body.id_token);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "password",
													"type": "text"
												},
												{
													"key": "username",
													"value": "bob",
													"type": "text"
												},
												{
													"key": "password",
													"value": "password",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "openid",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RS Login - PAT bearer",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Has an access_token\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('access_token');",
													"    pm.expect(body).to.have.property('token_type');",
													"    pm.expect(body.token_type).to.eql('bearer');",
													"    pm.expect(body).to.have.property('expires_in');",
													"    pm.expect(body).to.have.property('scope');",
													"    pm.expect(body.scope).to.eql('uma_protection');",
													"",
													"    pm.environment.set('rs_pat', body.access_token);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rs_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "client_credentials",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "uma_protection",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Extended Request Permission Ticket",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Ticket successfully created\", function () {",
													"    var body = pm.response.json();",
													"    //Check body",
													"    pm.expect(body).to.have.property('ticket');",
													"    //Save values",
													"    pm.environment.set('permission_ticket_extended', body.ticket);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"type": "text",
												"value": "Bearer {{rs_pat}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{permission_endpoint}}",
											"host": [
												"{{permission_endpoint}}"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "Invalid Case",
							"item": [
								{
									"name": "RPT Request - without ticket",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    pm.expect(body.error).to.eql(\"invalid_grant\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid ticket",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    pm.expect(body.error).to.eql(\"invalid_grant\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - missing claim_token",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "missingClaimToken",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - missing claim_token_format",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "missingClaimTokenFormat",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid claim_token_format",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "invalidFormat",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "missingClaimTokenFormat",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid claim_token",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_simple}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "malformedClaimToken",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid_scope unknown",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    //Test with a scope that has not been pre-registered into the application scopes settings.",
													"    pm.expect(body.error).to.eql(\"invalid_scope\");",
													"    pm.expect(body.error_description).to.eql(\"At least one of the scopes included in the request does not match client pre-registered scopes\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_extended}}",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "{{bob_id_token}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "profile:unknown",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid_scope unbound",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    //Test with a scope that has been pre-registered into the application scopes settings, but not on the resource_set",
													"    pm.expect(body.error).to.eql(\"invalid_scope\");",
													"    pm.expect(body.error_description).to.eql(\"At least one of the scopes included in the request does not match client pre-registered scopes\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_extended}}",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "{{bob_id_token}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "phone:write",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - with RPT expired",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    //Test with expired RPT",
													"    pm.expect(body.error).to.eql(\"invalid_grant\");",
													"    pm.expect(body.error_description).to.eql(\"Requesting Party Token (rpt) not valid\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_extended}}",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "{{bob_id_token}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "phone",
													"type": "text"
												},
												{
													"key": "rpt",
													"value": "eyJraWQiOiJkZWZhdWx0LWdyYXZpdGVlLUFNLWtleSIsImFsZyI6IkhTMjU2In0.eyJzdWIiOiIwMzQ4NDFmNC00ZjAwLTQwODYtODg0MS1mNDRmMDA2MDg2ODEiLCJhdWQiOiI5ZjA5Yzc1Ni00MjhkLTQ5MTgtODljNy01NjQyOGRhOTE4NmYiLCJwZXJtaXNzaW9ucyI6W3sicmVzb3VyY2VJZCI6Ijc3ZWEwZTk2LTBiMGMtNDBlNy1hYTBlLTk2MGIwYzQwZTcxNiIsInJlc291cmNlU2NvcGVzIjpbInZpZXciLCJkb3dubG9hZCJdfSx7InJlc291cmNlSWQiOiJhMzE5MjcwOC04NDllLTQwNDgtOTkyNy0wODg0OWVlMDQ4YWEiLCJyZXNvdXJjZVNjb3BlcyI6WyJ2aWV3IiwiZG93bmxvYWQiLCJlZGl0Il19XSwiZG9tYWluIjoidW1hMl9wb3N0bWFuIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDkyL3VtYTJfcG9zdG1hbi9vaWRjIiwiZXhwIjoxNTkxMDM3NDkwLCJpYXQiOjE1OTEwMzAyOTAsImp0aSI6Im5nR2FqbHVqaVF3cTVSQlJSaWF5LVJfeFJJOVBPSVliWmplNy16Ri14YlUifQ.xINS0vIiVAQ3bKl09SdrFiJIwBCl6B0sY5k31fWXVnU",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "Valid Cases",
							"item": [
								{
									"name": "Requesting Party - User",
									"item": [
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - no additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    ",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    //Save it, will be used to extend RPT",
															"    pm.environment.set('rqp_token', body.access_token);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"",
															"    pm.environment.set('rqp_refresh_token', body.refresh_token);",
															"});",
															"",
															"// wait for sync process",
															"setTimeout(function(){}, 5000);"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.not.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Refresh Token",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"",
															"    pm.environment.set('rqp_refresh_token', body.refresh_token);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "refresh_token",
															"type": "text"
														},
														{
															"key": "refresh_token",
															"value": "{{rqp_refresh_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.not.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(3);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\",\"address\"]);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_extended}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone address",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - with RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"/* ",
															" * In this test, I do expect to have : ",
															" *  - rpt previous permission (ressource_set_one)",
															" *  - resource_set_two with scope \"email\" coming from the ticket",
															" *  - additional scope \"phone\" on matching resource_set as requested into the body.",
															"*/",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body.upgraded).to.eql(true);",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"",
															"    //Save it, will be used to check introspection",
															"    pm.environment.set('extended_rpt', body.access_token);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate extended RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.not.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    const rs_two = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{extended_rpt}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - Check one time permission ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 400\", function () {",
															"    pm.response.to.have.status(400);",
															"});",
															"",
															"pm.test(\"Has an error\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('error');",
															"    pm.expect(body).to.have.property('error_description');",
															"",
															"    pm.expect(body.error).to.eql(\"invalid_grant\");",
															"    pm.expect(body.error_description).to.eql(\"Missing or invalid permission ticket.\");",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										}
									]
								},
								{
									"name": "Requesting Party - Client",
									"item": [
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - no additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    ",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    //Is not an end user bearer",
															"    pm.expect(payload.aud).to.eql(payload.sub);",
															"",
															"    //Save it, will be used to extend RPT",
															"    pm.environment.set('rqp_token', body.access_token);",
															"});",
															"",
															"pm.test(\"Has not a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.not.have.property('refresh_token');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is client access_token",
															"    pm.expect(body.sub).to.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.not.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(3);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\",\"address\"]);",
															"",
															"    //Is not an end user bearer",
															"    pm.expect(payload.aud).to.eql(payload.sub);",
															"});",
															"",
															"pm.test(\"Has not a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.not.have.property('refresh_token');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_extended}}",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone address",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - with RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"/* ",
															" * In this test, I do expect to have : ",
															" *  - rpt previous permission (ressource_set_one)",
															" *  - resource_set_two with scope \"email\" coming from the ticket",
															" *  - additional scope \"phone\" on matching resource_set as requested into the body.",
															"*/",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body.upgraded).to.eql(true);",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"    ",
															"    //Is not an end user bearer",
															"    pm.expect(payload.aud).to.eql(payload.sub);",
															"",
															"    //Save it, will be used to check introspection",
															"    pm.environment.set('extended_rpt', body.access_token);",
															"});",
															"",
															"pm.test(\"Has not a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.not.have.property('refresh_token');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate extended RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    const rs_two = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{extended_rpt}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - Check one time permission ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 400\", function () {",
															"    pm.response.to.have.status(400);",
															"});",
															"",
															"pm.test(\"Has an error\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('error');",
															"    pm.expect(body).to.have.property('error_description');",
															"",
															"    pm.expect(body.error).to.eql(\"invalid_grant\");",
															"    pm.expect(body.error_description).to.eql(\"Missing or invalid permission ticket.\");",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										}
									]
								},
								{
									"name": "Duplicated resource_id Request",
									"item": [
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{rs_pat}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"phone\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.not.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"",
															"    //Save it, will be used to extend RPT",
															"    pm.environment.set('rqp_token', body.access_token);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_extended}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.not.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    const rs_two = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										}
									]
								},
								{
									"name": "Requesting Party - Access Policies",
									"item": [
										{
											"name": "Case - deny all",
											"item": [
												{
													"name": "Assign denied policy to resource one",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Has a location\", function () {",
																	"    var body = pm.response.json();",
																	"    //Save values",
																	"    pm.environment.set('policy_location', pm.response.headers.get('Location'));",
																	"    pm.environment.set('policy_id', body.id);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nresult.state = State.FAILURE;\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{resource_location_one}}/policies",
															"host": [
																"{{resource_location_one}}"
															],
															"path": [
																"policies"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has an error\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"",
																	"    pm.expect(body.error).to.eql(\"invalid_grant\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Case - grant all",
											"item": [
												{
													"name": "Assign approved policy to resource one",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "PUT",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nresult.state = State.SUCCESS;\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{policy_location}}",
															"host": [
																"{{policy_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"function parseJwtPayload(token) {",
																	"    var base64Url = token.split('.')[1];",
																	"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
																	"    return JSON.parse(atob(base64));",
																	"}",
																	"",
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"",
																	"    let payload = parseJwtPayload(body.access_token);",
																	"    pm.expect(payload).to.have.property('permissions');",
																	"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
																	"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
																	"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Case - grant client",
											"item": [
												{
													"name": "Assign approved policy to resource one - wrong client",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "PUT",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nclient = context.attributes['client']\\\\nif(client.name == 'unknown') { result.state = State.SUCCESS; } else { result.state = State.FAILURE;}\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{policy_location}}",
															"host": [
																"{{policy_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has an error\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"",
																	"    pm.expect(body.error).to.eql(\"invalid_grant\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Assign approved policy to resource one - valid client",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "PUT",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nclient = context.attributes['client']\\\\nif(client.name == 'RQP-client') { result.state = State.SUCCESS; } else { result.state = State.FAILURE;}\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{policy_location}}",
															"host": [
																"{{policy_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"function parseJwtPayload(token) {",
																	"    var base64Url = token.split('.')[1];",
																	"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
																	"    return JSON.parse(atob(base64));",
																	"}",
																	"",
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"",
																	"    let payload = parseJwtPayload(body.access_token);",
																	"    pm.expect(payload).to.have.property('permissions');",
																	"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
																	"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
																	"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Case - grant user",
											"item": [
												{
													"name": "Assign approved policy to resource one - wrong user",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "PUT",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nuser = context.attributes['user']\\\\nif(user.username == 'unknown') { result.state = State.SUCCESS; } else { result.state = State.FAILURE;}\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{policy_location}}",
															"host": [
																"{{policy_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has an error\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"",
																	"    pm.expect(body.error).to.eql(\"invalid_grant\");",
																	"});",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Assign approved policy to resource one - valid user",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "PUT",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nuser = context.attributes['user']\\\\nif(user.username == 'bob') { result.state = State.SUCCESS; } else { result.state = State.FAILURE;}\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{policy_location}}",
															"host": [
																"{{policy_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"function parseJwtPayload(token) {",
																	"    var base64Url = token.split('.')[1];",
																	"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
																	"    return JSON.parse(atob(base64));",
																	"}",
																	"",
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"",
																	"    let payload = parseJwtPayload(body.access_token);",
																	"    pm.expect(payload).to.have.property('permissions');",
																	"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
																	"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
																	"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											]
										},
										{
											"name": "Case - grant permission request",
											"item": [
												{
													"name": "Assign approved policy to resource one - read only access",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "PUT",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nuser = context.attributes['user']\\\\npermissionRequest = context.attributes['permissionRequest']\\\\nif(user.username == 'bob' && permissionRequest.resourceScopes.contains('read')) { result.state = State.SUCCESS; } else { result.state = State.FAILURE;}\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{policy_location}}",
															"host": [
																"{{policy_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has an error\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"",
																	"    pm.expect(body.error).to.eql(\"invalid_grant\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Assign approved policy to resource one - profile only access",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "PUT",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"name\": \"policy-name\",\n\t\"enabled\": true,\n\t\"description\": \"policy-description\",\n\t\"type\": \"groovy\",\n\t\"condition\": {\n\t\t\"onRequestScript\": \"import io.gravitee.policy.groovy.PolicyResult.State\\\\nuser = context.attributes['user']\\\\npermissionRequest = context.attributes['permissionRequest']\\\\nif(user.username == 'bob' && permissionRequest.resourceScopes.contains('profile')) { result.state = State.SUCCESS; } else { result.state = State.FAILURE;}\"\n\t}\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{policy_location}}",
															"host": [
																"{{policy_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request Permission Ticket",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Ticket successfully created\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('ticket');",
																	"    //Save values",
																	"    pm.environment.set('permission_ticket_simple', body.ticket);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{rs_pat}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "RPT Request - no additional scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"exec": [
																	"function parseJwtPayload(token) {",
																	"    var base64Url = token.split('.')[1];",
																	"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
																	"    return JSON.parse(atob(base64));",
																	"}",
																	"",
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"",
																	"    let payload = parseJwtPayload(body.access_token);",
																	"    pm.expect(payload).to.have.property('permissions');",
																	"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
																	"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
																	"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
																	"type": "text"
																},
																{
																	"key": "ticket",
																	"value": "{{permission_ticket_simple}}",
																	"type": "text"
																},
																{
																	"key": "claim_token",
																	"value": "{{bob_id_token}}",
																	"type": "text"
																},
																{
																	"key": "claim_token_format",
																	"value": "urn:ietf:params:oauth:token-type:id_token",
																	"type": "text"
																}
															]
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											]
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "Delete domain",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {",
							"    pm.response.to.have.status(204);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
					"host": [
						"{{management_url}}"
					],
					"path": [
						"management",
						"organizations",
						"{{defaultOrganizationId}}",
						"environments",
						"{{defaultEnvironmentId}}",
						"domains",
						"{{domain}}"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	]
}