{
	"info": {
		"_postman_id": "51e693b7-470f-4263-9deb-2164b7c0ae73",
		"name": "Gravitee.io - AM - UMA 2.0 - app version",
		"description": "Test openid connect discovery specifications: https://openid.net/specs/openid-connect-discovery-1_0.html",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Prepare",
			"item": [
				{
					"name": "Generate admin token",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "efdb4c67-6fa9-496d-903f-3714413c5fcc",
								"exec": [
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var token = JSON.parse(responseBody);",
									"pm.environment.set('token', token.access_token);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW5hZG1pbg=="
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "password",
									"value": "adminadmin",
									"type": "text"
								}
							],
							"options": {
								"urlencoded": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/auth/token",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"auth",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create uma 2.0  domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "c453d529-ff25-48cc-bb8e-88572d9c0e09",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"pm.environment.set('domain', jsonData.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"uma2_postman\", \n\t\"description\": \"test user-managed access specifications\"\n}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete default identity provider",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "fd5fce07-6247-49ad-a6b2-bfb376b46ff0",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"password\\\"}]}\",\n  \"name\": \"inmemory\"\n}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities/default-idp-{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities",
								"default-idp-{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create in-memory IDP",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "1126f317-a037-4968-80fe-9e68e087e16b",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var body = JSON.parse(responseBody);",
									"pm.environment.set('idp.inmemory', body.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"Alice\\\",\\\"lastname\\\":\\\"Doe\\\",\\\"username\\\":\\\"alice\\\",\\\"password\\\":\\\"password\\\"},{\\\"firstname\\\":\\\"Bob\\\",\\\"lastname\\\":\\\"Doe\\\",\\\"username\\\":\\\"bob\\\",\\\"email\\\":\\\"bob.doe@mail.com\\\",\\\"password\\\":\\\"password\\\"}]}\",\n  \"name\": \"inmemory\"\n}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create RS application",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "c48797d5-8312-4dc1-8642-9d1e021cf740",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"",
									"pm.test(\"Saving credentials\", function () {",
									"    let body = JSON.parse(responseBody);",
									"",
									"    let client_id = body.settings.oauth.clientId;",
									"    let secret = body.settings.oauth.clientSecret;",
									"    let authentication = btoa(client_id + \":\" + secret);  ",
									"",
									"    //Save fields",
									"    pm.environment.set('rs_app', body.id);",
									"    pm.environment.set('rs_client_id', client_id);",
									"    pm.environment.set('rs_client_secret', secret);",
									"    pm.environment.set('rs_client_authentication', authentication);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"RS-client\",\n  \"type\": \"WEB\"\n}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications"
							]
						}
					},
					"response": []
				},
				{
					"name": "Configure RS application",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "b623a2df-d6da-464b-9cd4-e34fe252e055",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Check grant\", function () {",
									"    let body = JSON.parse(responseBody);",
									"    pm.expect(body.settings.oauth.grantTypes).to.eql([\"password\"]);",
									"    pm.expect(body.settings.oauth.scopes).to.eql([\"uma_protection\"]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"identities\": [\n    \"{{idp.inmemory}}\"\n  ],\n  \"settings\": {\n  \t\"oauth\": {\n  \t\t\"scopes\": [\"uma_protection\"],\n  \t\t\"redirectUris\": [],\n\t\t\"grantTypes\": [\"password\"]\n\t}\n  }\n}\n",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications/{{rs_app}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications",
								"{{rs_app}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create RqP application",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "1b4d9273-9ca2-4b12-88ea-fd4cecebd37c",
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"",
									"pm.test(\"Saving credentials\", function () {",
									"    let body = JSON.parse(responseBody);",
									"",
									"    let client_id = body.settings.oauth.clientId;",
									"    let secret = body.settings.oauth.clientSecret;",
									"    let authentication = btoa(client_id + \":\" + secret);  ",
									"",
									"    //Save fields",
									"    pm.environment.set('rqp_app', body.id);",
									"    pm.environment.set('rqp_client_id', client_id);",
									"    pm.environment.set('rqp_client_secret', secret);",
									"    pm.environment.set('rqp_client_authentication', authentication);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"RS-client\",\n  \"type\": \"WEB\"\n}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications"
							]
						}
					},
					"response": []
				},
				{
					"name": "Configure RqP application",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "1e827968-7ec4-47fe-9f5d-319a5517dd41",
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Check grant\", function () {",
									"    let body = JSON.parse(responseBody);",
									"    pm.expect(body.settings.oauth.grantTypes).to.have.members([\"password\",\"refresh_token\",\"urn:ietf:params:oauth:grant-type:uma-ticket\"]);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"identities\": [\n    \"{{idp.inmemory}}\"\n  ],\n  \"settings\": {\n  \t\"oauth\": {\n  \t\t\"redirectUris\": [],\n\t\t\"grantTypes\": [\"password\",\"refresh_token\",\"urn:ietf:params:oauth:grant-type:uma-ticket\"],\n\t\t\"scopes\": [\"openid\",\"profile\",\"email\",\"phone\",\"address\"]\n\t}\n  }\n}\n",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications/{{rqp_app}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications",
								"{{rqp_app}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Start domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "c881ffc1-6368-4060-abc7-37f540175edd",
								"exec": [
									"// wait for sync process",
									"setTimeout(function(){}, 5000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"enabled\": true\n}",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}"
							]
						}
					},
					"response": []
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "UMA_2.0",
			"item": [
				{
					"name": "Case - UMA disabled",
					"item": [
						{
							"name": "Discovery",
							"item": [
								{
									"name": "Gravitee AM .well-known",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "7cdf83aa-65e0-445c-8e8e-72175129aa59",
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Check discovery endpoints\", function () {",
													"    pm.response.to.be.header('Content-Type', 'application/json');",
													"    var body = pm.response.json();",
													"    ",
													"    pm.expect(body).to.have.property(\"openid-configuration\");",
													"    pm.expect(body).to.not.have.property(\"uma2-configuration\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{gateway_url}}/{{domain}}/.well-known",
											"host": [
												"{{gateway_url}}"
											],
											"path": [
												"{{domain}}",
												".well-known"
											]
										}
									},
									"response": []
								},
								{
									"name": "Gravitee UMA .well-known disabled",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "786e9cae-fddf-4bf4-b2b7-f249336b919a",
												"exec": [
													"pm.test(\"Status code is 404\", function () {",
													"    pm.response.to.have.status(404);",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{gateway_url}}/{{domain}}/uma/.well-known/uma2-configuration",
											"host": [
												"{{gateway_url}}"
											],
											"path": [
												"{{domain}}",
												"uma",
												".well-known",
												"uma2-configuration"
											]
										}
									},
									"response": []
								},
								{
									"name": "Fetch Token Endpoint",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "6a777780-85b1-49ea-af8d-54f3bfdcecc5",
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Check uma 2.0 discovery endpoint\", function () {",
													"    pm.response.to.be.header('Content-Type', 'application/json');",
													"    var body = pm.response.json();",
													"",
													"    //Oauth 2.0 endpoints",
													"    pm.expect(body).to.have.property(\"token_endpoint\");",
													"    pm.environment.set('oidcTokenEndpoint', body.token_endpoint);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{gateway_url}}/{{domain}}/oidc/.well-known/openid-configuration",
											"host": [
												"{{gateway_url}}"
											],
											"path": [
												"{{domain}}",
												"oidc",
												".well-known",
												"openid-configuration"
											]
										}
									},
									"response": []
								},
								{
									"name": "Token endpoint - Unsupported UMA grant",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "92c4ba70-c19b-478b-9071-2be3d33d07f2",
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"//Grant type must not be supported when UMA is disabled",
													"pm.test(\"Check grant type is not supported\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"    ",
													"    pm.expect(body.error).to.eql(\"unsupported_grant_type\");",
													"    pm.expect(body.error_description).to.eql(\"Unsupported grant type: urn:ietf:params:oauth:grant-type:uma-ticket\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"type": "text",
												"value": "Basic {{rs_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "must_fail_before",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{oidcTokenEndpoint}}",
											"host": [
												"{{oidcTokenEndpoint}}"
											]
										}
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Enable UMA 2.0",
					"item": [
						{
							"name": "Enable UMA",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "4624fc64-5d7f-426a-894c-b52493777b82",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"UMA enabled for domain\", function () {",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.uma.enabled).to.eql(true);",
											"});",
											"",
											"// wait for sync process",
											"setTimeout(function(){}, 5000);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "PATCH",
								"header": [
									{
										"key": "Authorization",
										"type": "text",
										"value": "Bearer {{token}}"
									},
									{
										"key": "Content-Type",
										"name": "Content-Type",
										"type": "text",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n  \"uma\": {\n    \"enabled\": true\n  }\n}",
									"options": {
										"raw": {}
									}
								},
								"url": {
									"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
									"host": [
										"{{management_url}}"
									],
									"path": [
										"management",
										"organizations",
										"{{defaultOrganizationId}}",
										"environments",
										"{{defaultEnvironmentId}}",
										"domains",
										"{{domain}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Gravitee AM .well-known",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "fffb7db0-4d28-455a-8970-bce6e423a2bd",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"Check uma is enabled\", function () {",
											"    pm.response.to.be.header('Content-Type', 'application/json');",
											"    let body = pm.response.json();",
											"    let expected_endpoint = pm.environment.get('gateway_url') + \"/\" + pm.environment.get('domain') + \"/uma/.well-known/uma2-configuration\";",
											"",
											"    pm.expect(body).to.have.property(\"openid-configuration\");",
											"    pm.expect(body).to.have.property(\"uma2-configuration\");",
											"",
											"    pm.expect(body['uma2-configuration']).to.eql(expected_endpoint);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/{{domain}}/.well-known",
									"host": [
										"{{gateway_url}}"
									],
									"path": [
										"{{domain}}",
										".well-known"
									]
								}
							},
							"response": []
						},
						{
							"name": "Gravitee UMA .well-known enabled",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "69ac69e6-991c-4bb2-8b7b-71696baf5eea",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"Check uma 2.0 discovery endpoint\", function () {",
											"    pm.response.to.be.header('Content-Type', 'application/json');",
											"    var body = pm.response.json();",
											"",
											"    //Specific uma 2.0 endpoints",
											"    pm.expect(body).to.have.property(\"resource_registration_endpoint\");",
											"    pm.expect(body).to.have.property(\"permission_endpoint\");",
											"    pm.expect(body).to.have.property(\"uma_profiles_supported\");",
											"    pm.expect(body).to.have.property(\"claims_interaction_endpoint\");",
											"    pm.environment.set('resource_registration_endpoint', body.resource_registration_endpoint);",
											"    pm.environment.set('permission_endpoint', body.permission_endpoint);",
											"",
											"    //Check UMA Grant is available",
											"    pm.expect(body.grant_types_supported).to.include('urn:ietf:params:oauth:grant-type:uma-ticket');",
											"",
											"    //Oauth 2.0 endpoints",
											"    pm.expect(body).to.have.property(\"token_endpoint\");",
											"    pm.expect(body).to.have.property(\"introspection_endpoint\");",
											"    pm.environment.set('tokenEndpoint', body.token_endpoint);",
											"    pm.environment.set('introspectionEndpoint', body.introspection_endpoint);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{gateway_url}}/{{domain}}/uma/.well-known/uma2-configuration",
									"host": [
										"{{gateway_url}}"
									],
									"path": [
										"{{domain}}",
										"uma",
										".well-known",
										"uma2-configuration"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "UMA Protection API",
					"item": [
						{
							"name": "Invalid cases",
							"item": [
								{
									"name": "Not a PAT (Protection Api Token)",
									"item": [
										{
											"name": "Login without UMA scope",
											"item": [
												{
													"name": "Login without - Not PAT",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "9c61d010-d49a-4cfd-894b-bf5479b7fc70",
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"    ",
																	"    pm.environment.set('access_token', body.access_token);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rqp_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "password",
																	"type": "text"
																},
																{
																	"key": "username",
																	"value": "alice",
																	"type": "text"
																},
																{
																	"key": "password",
																	"value": "password",
																	"type": "text"
																}
															],
															"options": {
																"urlencoded": {}
															}
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										},
										{
											"name": "Resource Registration",
											"item": [
												{
													"name": "Not Authenticated",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "6c3d054a-1483-44d6-a4b7-3ba26c798d36",
																"exec": [
																	"pm.test(\"Status code is 401\", function () {",
																	"    pm.response.to.have.status(401);",
																	"});",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [],
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Not Supported method",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "c513b27b-4ff4-4537-a37e-9743978e14a5",
																"exec": [
																	"pm.test(\"Status code is 405\", function () {",
																	"    pm.response.to.have.status(405);",
																	"});",
																	"",
																	"pm.test(\"Check 405 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"    ",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"unsupported_method_type\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "DELETE",
														"header": [],
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Missing scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "8fa22d1b-20b3-406e-b5ec-ca5d62e2cf8d",
																"exec": [
																	"pm.test(\"Status code is 403\", function () {",
																	"    pm.response.to.have.status(403);",
																	"});",
																	"",
																	"pm.test(\"Check 403 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"insufficient_scope\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "Authorization",
																"value": "Bearer {{access_token}}",
																"type": "text"
															}
														],
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										},
										{
											"name": "Permission Ticket",
											"item": [
												{
													"name": "Not Authenticated",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "050c51ab-d0ec-486e-a50c-f706803239d1",
																"exec": [
																	"pm.test(\"Status code is 401\", function () {",
																	"    pm.response.to.have.status(401);",
																	"});",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Content-Type",
																"value": "application/json",
																"type": "text"
															}
														],
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Not Supported method",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "48e5fdec-5b63-4017-80fe-801d4c940882",
																"exec": [
																	"pm.test(\"Status code is 405\", function () {",
																	"    pm.response.to.have.status(405);",
																	"});",
																	"",
																	"pm.test(\"Check 405 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"unsupported_method_type\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "DELETE",
														"header": [],
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Missing scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "7ffe98a8-2120-47b3-b123-9cc798cf0085",
																"exec": [
																	"pm.test(\"Status code is 403\", function () {",
																	"    pm.response.to.have.status(403);",
																	"});",
																	"",
																	"pm.test(\"Check 403 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"insufficient_scope\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Bearer {{access_token}}",
																"type": "text"
															},
															{
																"key": "Content-Type",
																"value": "application/json",
																"type": "text"
															}
														],
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "With a PAT (Protection Api Token)",
									"item": [
										{
											"name": "Prepare - Login with UMA scope",
											"item": [
												{
													"name": "Alice Login - PAT bearer",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "c7cfa046-a0eb-4595-8c01-3c6a5603f3b7",
																"exec": [
																	"pm.test(\"Status code is 200\", function () {",
																	"    pm.response.to.have.status(200);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    pm.expect(body).to.have.property('access_token');",
																	"    pm.expect(body).to.have.property('token_type');",
																	"    pm.expect(body.token_type).to.eql('bearer');",
																	"    pm.expect(body).to.have.property('expires_in');",
																	"    pm.expect(body).to.have.property('scope');",
																	"    pm.expect(body.scope).to.eql('uma_protection');",
																	"",
																	"    pm.environment.set('protection_api_token', body.access_token);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"value": "Basic {{rs_client_authentication}}"
															}
														],
														"body": {
															"mode": "urlencoded",
															"urlencoded": [
																{
																	"key": "grant_type",
																	"value": "password",
																	"type": "text"
																},
																{
																	"key": "username",
																	"value": "alice",
																	"type": "text"
																},
																{
																	"key": "password",
																	"value": "password",
																	"type": "text"
																},
																{
																	"key": "scope",
																	"value": "uma_protection",
																	"type": "text"
																}
															],
															"options": {
																"urlencoded": {}
															}
														},
														"url": {
															"raw": "{{tokenEndpoint}}",
															"host": [
																"{{tokenEndpoint}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										},
										{
											"name": "Resource Registration",
											"item": [
												{
													"name": "Icon Uri malformed",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "a3d0e93e-371e-4add-b346-4d943a352d65",
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has a location\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"    pm.expect(body.error_description).to.include(\"Icon uri claim is malformed\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"protocolProfileBehavior": {
														"disabledSystemHeaders": {
															"user-agent": true
														}
													},
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"description\":\"Should fail due to malformed icon_uri\",\n   \"name\":\"Should fail\",\n   \"icon_uri\":\"trigger_malformed_icon_uri\"\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Scope not found",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "18caa8ed-ed98-4704-9d7d-f53b49668278",
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Has a location\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('error');",
																	"    pm.expect(body).to.have.property('error_description');",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"    pm.expect(body.error_description).to.include(\"Scope [not_foud] can not be found.\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"protocolProfileBehavior": {
														"disabledSystemHeaders": {
															"user-agent": true
														}
													},
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_scopes\":[  \n      \"not_foud\"\n   ],\n   \"description\":\"Should fail due to missing scope\",\n   \"name\":\"Should fail\"\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										},
										{
											"name": "Permission Ticket",
											"item": [
												{
													"name": "Parsing Error",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "98a4d503-9316-470d-a6db-5dfeb80a6f1c",
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check 405 response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_id_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile:read\",\n\t\t\t\"email:read\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_id_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_id_two}}\",\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request - Invalid Request",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "343001f7-768f-4d74-8300-626fec137fc0",
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_id\":\"test\",\n   \"resource_scopes\":[  \n      \"valide one\",\n      \"\"\n   ]\n   \n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Extended Permission - Invalid Request",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "443d0330-783b-4aa7-9422-a0e9cb691ad3",
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_request\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile:read\",\n\t\t\t\"email:read\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_scopes\":[  \n\t\t\t\"avatar:write\"\n\t\t]\n\t}\n]",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Create Resource",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "c32c9d3b-e6e3-4ce1-a29c-09c15ed2a6fa",
																"exec": [
																	"pm.test(\"Status code is 201\", function () {",
																	"    pm.response.to.have.status(201);",
																	"});",
																	"",
																	"pm.test(\"Has an access_token\", function () {",
																	"    var body = pm.response.json();",
																	"    //Check headers",
																	"    pm.response.to.have.header(\"Content-Type\");",
																	"    pm.response.to.have.header('Location');",
																	"    //Check body",
																	"    pm.expect(body).to.have.property('_id');",
																	"    pm.expect(body).to.have.property('resource_scopes');",
																	"    ",
																	"    //Save values",
																	"    pm.environment.set('resource_location', pm.response.headers.get('Location'));",
																	"    pm.environment.set('resource_id', body._id);",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"protocolProfileBehavior": {
														"disabledSystemHeaders": {
															"user-agent": true
														}
													},
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"description\":\"desc\",\n   \"name\":\"name\"\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{resource_registration_endpoint}}",
															"host": [
																"{{resource_registration_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request - Invalid resource scope",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "e441b308-d8df-4809-8226-8e7f29bee283",
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_scope\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_id\":\"{{resource_id}}\",\n   \"resource_scopes\":[\n   \t  \"profile\",\n      \"not found\"\n   ]\n   \n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Delete Resource",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "36e3d81b-1c63-4e22-827d-4f09f2917f31",
																"exec": [
																	"pm.test(\"Status code is 204\", function () {",
																	"    pm.response.to.have.status(204);",
																	"});",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"protocolProfileBehavior": {
														"disabledSystemHeaders": {
															"user-agent": true
														}
													},
													"request": {
														"auth": {
															"type": "noauth"
														},
														"method": "DELETE",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"url": {
															"raw": "{{resource_location}}",
															"host": [
																"{{resource_location}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Simple Request - Invalid resource id",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "d4a261fc-0925-45ff-b3c2-88dc83e7db23",
																"exec": [
																	"pm.test(\"Status code is 400\", function () {",
																	"    pm.response.to.have.status(400);",
																	"});",
																	"",
																	"pm.test(\"Check response\", function () {",
																	"    pm.response.to.be.header('Content-Type', 'application/json');",
																	"    var body = pm.response.json();",
																	"",
																	"    //Requested uma 2.0 response",
																	"    pm.expect(body).to.have.property(\"error\");",
																	"    pm.expect(body.error).to.eql(\"invalid_resource_id\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "POST",
														"header": [
															{
																"key": "Authorization",
																"type": "text",
																"value": "Bearer {{protection_api_token}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{  \n   \"resource_id\":\"{{resource_id}}\",\n   \"resource_scopes\":[  \n      \"email\"\n   ]\n   \n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{permission_endpoint}}",
															"host": [
																"{{permission_endpoint}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								}
							],
							"description": "Case when user bearer called Protected Access Token (PAT) does not contains uma_protected scope.",
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Nominal case",
							"item": [
								{
									"name": "Prepare - Login with UMA scope",
									"item": [
										{
											"name": "Alice Login - PAT bearer",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "0b4f43fd-f456-49a2-84d8-e3079958b3ff",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.have.property('scope');",
															"    pm.expect(body.scope).to.eql('uma_protection');",
															"",
															"    pm.environment.set('protection_api_token', body.access_token);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rs_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "password",
															"type": "text"
														},
														{
															"key": "username",
															"value": "alice",
															"type": "text"
														},
														{
															"key": "password",
															"value": "password",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "uma_protection",
															"type": "text"
														}
													],
													"options": {
														"urlencoded": {}
													}
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Resource Registration",
									"item": [
										{
											"name": "List",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "5a5d1cdb-9320-48c3-8211-3712f50ba24b",
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"host": true,
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer {{protection_api_token}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Create",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "f829057d-80d8-4710-aaf0-87beef9bf255",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Has a location\", function () {",
															"    var body = pm.response.json();",
															"    //Check headers",
															"    pm.response.to.have.header(\"Content-Type\");",
															"    pm.response.to.have.header('Location');",
															"    //Check body",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"",
															"    //Save values",
															"    pm.environment.set('resource_location', pm.response.headers.get('Location'));",
															"    pm.environment.set('resource_id', body._id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"phone\"\n   ],\n   \"description\":\"photo1\",\n   \"icon_uri\":\"http://www.example.com/icons/picture.png\",\n   \"name\":\"Photo access\",\n   \"type\":\"http://www.example.com/resource/photo\"\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Get",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "e5ce0602-195d-446c-b841-743c089caebf",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Is able to fetch resource_set\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location}}",
													"host": [
														"{{resource_location}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Update",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "81fa3037-4bb5-4213-b513-ac13c6559463",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Is able to update resource_set\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"    pm.expect(body).to.have.property('name');",
															"",
															"    pm.expect(body.name).to.eql('updated');",
															"    pm.expect(body.resource_scopes).to.eql([\"profile\"]);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "PUT",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"name\":\"updated\"\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_location}}",
													"host": [
														"{{resource_location}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "List",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "c3493101-3fd7-47b3-8959-519a46862767",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Can find resource_set in list\", function () {",
															"    var body = pm.response.json();",
															"    console.log(body[0]);",
															"    console.log(pm.environment.get('resource_id'));",
															"    pm.expect(body[0]).to.eql(pm.environment.get('resource_id'));",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"host": true,
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "GET",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Delete",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "703588a7-48e5-4dc4-ac42-967d0365429a",
														"exec": [
															"pm.test(\"Status code is 204\", function () {",
															"    pm.response.to.have.status(204);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "DELETE",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"url": {
													"raw": "{{resource_location}}",
													"host": [
														"{{resource_location}}"
													]
												}
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Permission Ticket",
									"item": [
										{
											"name": "Create New Resource One",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "b4f2e419-d7e1-41ae-a059-0d04eb021e5a",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    //Check headers",
															"    pm.response.to.have.header(\"Content-Type\");",
															"    pm.response.to.have.header('Location');",
															"    //Check body",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"",
															"    //Save values",
															"    pm.environment.set('resource_location_one', pm.response.headers.get('Location'));",
															"    pm.environment.set('resource_set_one', body._id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"profile\"\n   ],\n   \"description\":\"Give access to profile information\",\n   \"icon_uri\": null,\n   \"name\":\"Profile access\",\n   \"type\":null\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Create New Resource Two",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "d837e8a5-334b-47f9-b710-04ed2ed1cbee",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    //Check headers",
															"    pm.response.to.have.header(\"Content-Type\");",
															"    pm.response.to.have.header('Location');",
															"    //Check body",
															"    pm.expect(body).to.have.property('_id');",
															"    pm.expect(body).to.have.property('resource_scopes');",
															"",
															"    //Save values",
															"    pm.environment.set('resource_location_two', pm.response.headers.get('Location'));",
															"    pm.environment.set('resource_set_two', body._id);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"user-agent": true
												}
											},
											"request": {
												"auth": {
													"type": "noauth"
												},
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_scopes\":[  \n      \"phone\",\n      \"email\",\n      \"address\"\n   ],\n   \"description\":\"Phone, email and address access\",\n   \"name\":\"Contact access\"\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{resource_registration_endpoint}}",
													"host": [
														"{{resource_registration_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "78b20545-74b8-43b9-9648-8f4912365c44",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Bearer {{protection_api_token}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{  \n   \"resource_id\":\"{{resource_set_one}}\",\n   \"resource_scopes\":[  \n      \"profile\"\n   ]\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "4730c084-2bb8-4418-a197-715d25909607",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "UMA Grant",
					"item": [
						{
							"name": "Prepare",
							"item": [
								{
									"name": "Bob Login - to RqP Client",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "dbf32841-0540-4297-8a88-4a17cf2849d2",
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Has an access_token\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('access_token');",
													"    pm.expect(body).to.have.property('token_type');",
													"    pm.expect(body.token_type).to.eql('bearer');",
													"    pm.expect(body).to.have.property('expires_in');",
													"    pm.expect(body).to.have.property('scope');",
													"    pm.expect(body.scope).to.eql('openid');",
													"    pm.expect(body).to.have.property('id_token');",
													"",
													"    pm.environment.set('bob_id_token', body.id_token);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "password",
													"type": "text"
												},
												{
													"key": "username",
													"value": "bob",
													"type": "text"
												},
												{
													"key": "password",
													"value": "password",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "openid",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Extended Request Permission Ticket",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "8ae4119f-cab9-4e08-b011-dd6d69e2e7ef",
												"exec": [
													"pm.test(\"Status code is 201\", function () {",
													"    pm.response.to.have.status(201);",
													"});",
													"",
													"pm.test(\"Ticket successfully created\", function () {",
													"    var body = pm.response.json();",
													"    //Check body",
													"    pm.expect(body).to.have.property('ticket');",
													"    //Save values",
													"    pm.environment.set('permission_ticket_extended', body.ticket);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"type": "text",
												"value": "Bearer {{protection_api_token}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "{{permission_endpoint}}",
											"host": [
												"{{permission_endpoint}}"
											]
										}
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Invalid Case",
							"item": [
								{
									"name": "RPT Request - without ticket",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "6718bbb5-14c7-46a4-b142-476e0f724d18",
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    pm.expect(body.error).to.eql(\"invalid_grant\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid ticket",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "92cfce42-e295-4c00-b681-4d256d70d7f6",
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    pm.expect(body.error).to.eql(\"invalid_grant\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - missing claim_token",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "03ebe71a-1410-412b-a630-d941862ce8e6",
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "missingClaimToken",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - missing claim_token_format",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "857e39f9-2f5d-4dfc-bd14-cc514f96c182",
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "missingClaimTokenFormat",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid claim_token_format",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "f186ae1d-0dd1-4002-8d7a-7f804aac75fa",
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "notfound",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "invalidFormat",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "missingClaimTokenFormat",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid claim_token",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "6792d712-1675-4220-b02c-4c253e6fa1c8",
												"exec": [
													"pm.test(\"Status code is 403\", function () {",
													"    pm.response.to.have.status(403);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('ticket');",
													"",
													"    pm.expect(body.error).to.eql(\"need_info\");",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_simple}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "malformedClaimToken",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid_scope unknown",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "90701f6d-7ea7-4696-bc4d-437afb39423c",
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    //Test with a scope that has not been pre-registered into the application scopes settings.",
													"    pm.expect(body.error).to.eql(\"invalid_scope\");",
													"    pm.expect(body.error_description).to.eql(\"At least one of the scopes included in the request does not match client pre-registered scopes\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_extended}}",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "{{bob_id_token}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "profile:unknown",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - invalid_scope unbound",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "d6ff6797-86e1-4e38-bd4f-d6a83732cb96",
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    //Test with a scope that has been pre-registered into the application scopes settings, but not on the resource_set",
													"    pm.expect(body.error).to.eql(\"invalid_scope\");",
													"    pm.expect(body.error_description).to.eql(\"At least one of the scopes included in the request does not match client pre-registered scopes\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_extended}}",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "{{bob_id_token}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "phone:write",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "RPT Request - with RPT expired",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "eb6803d7-c661-4a9c-8462-47f78ca11b31",
												"exec": [
													"pm.test(\"Status code is 400\", function () {",
													"    pm.response.to.have.status(400);",
													"});",
													"",
													"pm.test(\"Has an error\", function () {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('error');",
													"    pm.expect(body).to.have.property('error_description');",
													"",
													"    //Test with expired RPT",
													"    pm.expect(body.error).to.eql(\"invalid_grant\");",
													"    pm.expect(body.error_description).to.eql(\"Requesting Party Token (rpt) not valid\");",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Authorization",
												"value": "Basic {{rqp_client_authentication}}"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
													"type": "text"
												},
												{
													"key": "ticket",
													"value": "{{permission_ticket_extended}}",
													"type": "text"
												},
												{
													"key": "claim_token",
													"value": "{{bob_id_token}}",
													"type": "text"
												},
												{
													"key": "claim_token_format",
													"value": "urn:ietf:params:oauth:token-type:id_token",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "phone",
													"type": "text"
												},
												{
													"key": "rpt",
													"value": "eyJraWQiOiJkZWZhdWx0LWdyYXZpdGVlLUFNLWtleSIsImFsZyI6IkhTMjU2In0.eyJzdWIiOiIwMzQ4NDFmNC00ZjAwLTQwODYtODg0MS1mNDRmMDA2MDg2ODEiLCJhdWQiOiI5ZjA5Yzc1Ni00MjhkLTQ5MTgtODljNy01NjQyOGRhOTE4NmYiLCJwZXJtaXNzaW9ucyI6W3sicmVzb3VyY2VJZCI6Ijc3ZWEwZTk2LTBiMGMtNDBlNy1hYTBlLTk2MGIwYzQwZTcxNiIsInJlc291cmNlU2NvcGVzIjpbInZpZXciLCJkb3dubG9hZCJdfSx7InJlc291cmNlSWQiOiJhMzE5MjcwOC04NDllLTQwNDgtOTkyNy0wODg0OWVlMDQ4YWEiLCJyZXNvdXJjZVNjb3BlcyI6WyJ2aWV3IiwiZG93bmxvYWQiLCJlZGl0Il19XSwiZG9tYWluIjoidW1hMl9wb3N0bWFuIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDkyL3VtYTJfcG9zdG1hbi9vaWRjIiwiZXhwIjoxNTkxMDM3NDkwLCJpYXQiOjE1OTEwMzAyOTAsImp0aSI6Im5nR2FqbHVqaVF3cTVSQlJSaWF5LVJfeFJJOVBPSVliWmplNy16Ri14YlUifQ.xINS0vIiVAQ3bKl09SdrFiJIwBCl6B0sY5k31fWXVnU",
													"type": "text"
												}
											],
											"options": {
												"urlencoded": {}
											}
										},
										"url": {
											"raw": "{{tokenEndpoint}}",
											"host": [
												"{{tokenEndpoint}}"
											]
										}
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Valid Cases",
							"item": [
								{
									"name": "Requesting Party - User",
									"item": [
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "6d7efa5c-2dae-4f06-97ac-bfe120693c45",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - no additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "30d72a45-69a8-4d28-9d49-51a7962d3ba0",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    ",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    //Save it, will be used to extend RPT",
															"    pm.environment.set('rqp_token', body.access_token);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"",
															"    pm.environment.set('rqp_refresh_token', body.refresh_token);",
															"});",
															"",
															"// wait for sync process",
															"setTimeout(function(){}, 5000);"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "17c90624-9233-48c6-b31a-886cd1706df8",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.not.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Refresh Token",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "8c2e4fa5-4f9e-4d2b-8870-84a5cddf5208",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"",
															"    pm.environment.set('rqp_refresh_token', body.refresh_token);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "refresh_token",
															"type": "text"
														},
														{
															"key": "refresh_token",
															"value": "{{rqp_refresh_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "2ce4e909-673b-4f7e-8b64-01779e03a7c2",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "b19e1dfb-4f89-4954-852b-224a7f8a7c10",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.not.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(3);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\",\"address\"]);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_extended}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone address",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "5f7e7c18-31b7-4d0c-ad51-677674a7a5f5",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - with RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "137ff4d9-ac7e-4cf2-aa12-93f5acef4426",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"/* ",
															" * In this test, I do expect to have : ",
															" *  - rpt previous permission (ressource_set_one)",
															" *  - resource_set_two with scope \"email\" coming from the ticket",
															" *  - additional scope \"phone\" on matching resource_set as requested into the body.",
															"*/",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body.upgraded).to.eql(true);",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"",
															"    //Save it, will be used to check introspection",
															"    pm.environment.set('extended_rpt', body.access_token);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate extended RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "e7c39b50-6dc6-4fa2-8f56-15dec54abef0",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.not.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    const rs_two = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{extended_rpt}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - Check one time permission ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "556bb1e3-1fb2-49df-8a42-3805e19c23dd",
														"exec": [
															"pm.test(\"Status code is 400\", function () {",
															"    pm.response.to.have.status(400);",
															"});",
															"",
															"pm.test(\"Has an error\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('error');",
															"    pm.expect(body).to.have.property('error_description');",
															"",
															"    pm.expect(body.error).to.eql(\"invalid_grant\");",
															"    pm.expect(body.error_description).to.eql(\"Missing or invalid permission ticket.\");",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Requesting Party - Client",
									"item": [
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "f623dd3a-cfb3-40a3-8786-af40abcc925b",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - no additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "4fac055c-d466-4a97-91cd-d68a72af18c3",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    ",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    //Is not an end user bearer",
															"    pm.expect(payload.aud).to.eql(payload.sub);",
															"",
															"    //Save it, will be used to extend RPT",
															"    pm.environment.set('rqp_token', body.access_token);",
															"});",
															"",
															"pm.test(\"Has not a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.not.have.property('refresh_token');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "a8eac091-b751-4568-ad28-f4b65a542cee",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is client access_token",
															"    pm.expect(body.sub).to.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "dab1ee13-6491-4809-b32d-d1a1da382626",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - additional scope",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "51136406-dae6-4f87-923d-4ab7c9d9996b",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.not.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(3);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\",\"address\"]);",
															"",
															"    //Is not an end user bearer",
															"    pm.expect(payload.aud).to.eql(payload.sub);",
															"});",
															"",
															"pm.test(\"Has not a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.not.have.property('refresh_token');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_extended}}",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone address",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Simple Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "679fc5eb-4bdc-4259-955f-0543cc4ef840",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_simple', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - with RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "25d029ee-ea88-493d-93a5-1ffa6507ed2f",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"/* ",
															" * In this test, I do expect to have : ",
															" *  - rpt previous permission (ressource_set_one)",
															" *  - resource_set_two with scope \"email\" coming from the ticket",
															" *  - additional scope \"phone\" on matching resource_set as requested into the body.",
															"*/",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"    pm.expect(body.upgraded).to.eql(true);",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"    ",
															"    //Is not an end user bearer",
															"    pm.expect(payload.aud).to.eql(payload.sub);",
															"",
															"    //Save it, will be used to check introspection",
															"    pm.environment.set('extended_rpt', body.access_token);",
															"});",
															"",
															"pm.test(\"Has not a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.not.have.property('refresh_token');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate extended RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "93c1014e-e354-44ec-813e-ddab77ea0720",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    const rs_two = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{extended_rpt}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request - Check one time permission ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "95f02e1a-61cd-4600-951d-6cff686e2cfe",
														"exec": [
															"pm.test(\"Status code is 400\", function () {",
															"    pm.response.to.have.status(400);",
															"});",
															"",
															"pm.test(\"Has an error\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('error');",
															"    pm.expect(body).to.have.property('error_description');",
															"",
															"    pm.expect(body.error).to.eql(\"invalid_grant\");",
															"    pm.expect(body.error_description).to.eql(\"Missing or invalid permission ticket.\");",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_simple}}",
															"type": "text"
														},
														{
															"key": "scope",
															"value": "phone",
															"type": "text"
														},
														{
															"key": "rpt",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Duplicated resource_id Request",
									"item": [
										{
											"name": "Extended Request Permission Ticket",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "239134b6-b9e4-40f4-8863-1caf5ef6643e",
														"exec": [
															"pm.test(\"Status code is 201\", function () {",
															"    pm.response.to.have.status(201);",
															"});",
															"",
															"pm.test(\"Ticket successfully created\", function () {",
															"    var body = pm.response.json();",
															"    //Check body",
															"    pm.expect(body).to.have.property('ticket');",
															"    //Save values",
															"    pm.environment.set('permission_ticket_extended', body.ticket);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Bearer {{protection_api_token}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "[\n\t{  \n\t\t\"resource_id\":\"{{resource_set_one}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"profile\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"email\"\n\t\t]\n\t},\n\t{  \n\t\t\"resource_id\":\"{{resource_set_two}}\",\n\t\t\"resource_scopes\":[  \n\t\t\t\"phone\"\n\t\t]\n\t}\n]",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{permission_endpoint}}",
													"host": [
														"{{permission_endpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "RPT Request",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "4ff78303-7919-4d8d-a186-f44b16ca5fba",
														"exec": [
															"function parseJwtPayload (token) {",
															"    var base64Url = token.split('.')[1];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has an access_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('access_token');",
															"    pm.expect(body).to.have.property('token_type');",
															"    pm.expect(body).to.have.property('expires_in');",
															"    pm.expect(body).to.not.have.property('upgraded');",
															"",
															"    pm.expect(body.token_type).to.eql('bearer');",
															"",
															"",
															"    let payload = parseJwtPayload(body.access_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"    const rs_one = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    const rs_two = payload.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);//ensure no duplicated keys",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"",
															"    //Save it, will be used to extend RPT",
															"    pm.environment.set('rqp_token', body.access_token);",
															"});",
															"",
															"pm.test(\"Has a refresh_token\", function () {",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('refresh_token');",
															"   ",
															"    let payload = parseJwtPayload(body.refresh_token);",
															"    pm.expect(payload).to.have.property('permissions');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "grant_type",
															"value": "urn:ietf:params:oauth:grant-type:uma-ticket",
															"type": "text"
														},
														{
															"key": "ticket",
															"value": "{{permission_ticket_extended}}",
															"type": "text"
														},
														{
															"key": "claim_token",
															"value": "{{bob_id_token}}",
															"type": "text"
														},
														{
															"key": "claim_token_format",
															"value": "urn:ietf:params:oauth:token-type:id_token",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{tokenEndpoint}}",
													"host": [
														"{{tokenEndpoint}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Introspection - Validate RPT",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "8b97b7e1-50df-4578-9407-160c90a8dc5f",
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Has permissions\", function () {",
															"    pm.response.to.be.json;",
															"    var body = pm.response.json();",
															"    pm.expect(body).to.have.property('sub');",
															"    pm.expect(body).to.have.property('client_id');",
															"    pm.expect(body).to.have.property('permissions');",
															"",
															"    //Is user access_token",
															"    pm.expect(body.sub).to.not.eql(body.client_id);",
															"",
															"    const rs_one = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_one\"));",
															"    pm.expect(rs_one.resourceScopes.length).to.eql(1);",
															"    pm.expect(rs_one.resourceScopes).to.have.members([\"profile\"]);",
															"",
															"    const rs_two = body.permissions.find(p => p.resourceId === pm.environment.get(\"resource_set_two\"));",
															"    pm.expect(rs_two.resourceScopes.length).to.eql(2);",
															"    pm.expect(rs_two.resourceScopes).to.have.members([\"email\",\"phone\"]);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Authorization",
														"type": "text",
														"value": "Basic {{rqp_client_authentication}}"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "token",
															"value": "{{rqp_token}}",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{introspectionEndpoint}}",
													"host": [
														"{{introspectionEndpoint}}"
													]
												}
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Delete domain",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "ca793c75-478c-43ef-9061-2232f55531c0",
						"exec": [
							"pm.test(\"Status code is 204\", function () {",
							"    pm.response.to.have.status(204);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "",
					"options": {
						"raw": {}
					}
				},
				"url": {
					"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
					"host": [
						"{{management_url}}"
					],
					"path": [
						"management",
						"organizations",
						"{{defaultOrganizationId}}",
						"environments",
						"{{defaultEnvironmentId}}",
						"domains",
						"{{domain}}"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "474dbff1-72c3-43d0-b3fa-08bae0f5ada1",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "22ba6337-8fae-4223-a165-c5e19a817ec5",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"protocolProfileBehavior": {}
}