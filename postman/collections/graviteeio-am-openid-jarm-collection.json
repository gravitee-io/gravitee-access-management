{
	"info": {
		"_postman_id": "c44f03a8-bd4d-4cc8-86c3-f67937c2a722",
		"name": "Gravitee.io - AM - Openid JARM",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Prepare",
			"item": [
				{
					"name": "Generate admin token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var token = JSON.parse(responseBody);",
									"pm.environment.set('token', token.access_token);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW5hZG1pbg=="
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "password",
									"value": "adminadmin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{management_url}}/management/auth/token",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"auth",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create jarm domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"DCR disabled for domain\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.allowLocalhostRedirectUri).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.allowHttpSchemeRedirectUri).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.allowWildCardRedirectUri).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.isDynamicClientRegistrationEnabled).to.eql(false);",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.isOpenDynamicClientRegistrationEnabled).to.eql(false);",
									"    ",
									"    pm.environment.set('domain', jsonData.id);",
									"    pm.environment.set('domainHrid', jsonData.hrid);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"jarm\", \n\t\"description\": \"Test OpenID JARM specification\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "Enable DCR - non open mode ",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"DCR enabled for domain\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.oidc.clientRegistrationSettings.isDynamicClientRegistrationEnabled).to.eql(true);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 10000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"oidc\": {\n    \"clientRegistrationSettings\": {\n      \"allowLocalhostRedirectUri\": false,\n      \"allowHttpSchemeRedirectUri\": false,\n      \"allowWildCardRedirectUri\": false,\n      \"isDynamicClientRegistrationEnabled\": true,\n      \"isOpenDynamicClientRegistrationEnabled\": false\n    }\n  }\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete default identity provider",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"password\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities/default-idp-{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities",
								"default-idp-{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create in-memory IDP",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var body = JSON.parse(responseBody);",
									"pm.environment.set('idp.inmemory', body.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"domainWhitelist\" : [],\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"password\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/identities",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"identities"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get default certificate ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Get default certificate id\", function () {",
									"    pm.response.to.be.header('Content-Type', 'application/json');",
									"    var body = pm.response.json();",
									"    pm.environment.set('defaultCertificateId', body[0].id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Delete default certificate",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 204\", function () {",
									"    pm.response.to.have.status(204);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"external\": false,\n  \"type\": \"inline-am-idp\",\n  \"configuration\": \"{\\\"users\\\":[{\\\"firstname\\\":\\\"my-user\\\",\\\"lastname\\\":\\\"my-user-lastname\\\",\\\"username\\\":\\\"user\\\",\\\"password\\\":\\\"password\\\"}]}\",\n  \"name\": \"inmemory\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates/{{defaultCertificateId}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates",
								"{{defaultCertificateId}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create jks certificate rs256",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Extension Grant - create jks certificate\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.environment.set('certificateJks', jsonData.id);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"type\": \"javakeystore-am-certificate\",\n  \"configuration\": \"{\\\"jks\\\":\\\"{\\\\\\\"name\\\\\\\":\\\\\\\"server.jks\\\\\\\",\\\\\\\"type\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"size\\\\\\\":2237,\\\\\\\"content\\\\\\\":\\\\\\\"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\\\\\\\"}\\\",\\\"storepass\\\":\\\"changeme\\\",\\\"alias\\\":\\\"mytestkey\\\",\\\"keypass\\\":\\\"letmein\\\"}\",\n  \"name\": \"Test\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create jks certificate rs512",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Extension Grant - create jks certificate\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.environment.set('certificateJksRs512', jsonData.id);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 1000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"type\": \"javakeystore-am-certificate\",\n  \"configuration\": \"{\\\"jks\\\":\\\"{\\\\\\\"name\\\\\\\":\\\\\\\"server.jks\\\\\\\",\\\\\\\"type\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"size\\\\\\\":2237,\\\\\\\"content\\\\\\\":\\\\\\\"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\\\\\\\"}\\\",\\\"storepass\\\":\\\"changeme\\\",\\\"alias\\\":\\\"mytestkey\\\",\\\"keypass\\\":\\\"letmein\\\"}\",\n  \"name\": \"Test\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Start domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// wait for sync process",
									"setTimeout(function(){}, 10000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"enabled\": true\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "well-known/openid-configuration",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Check discovery endpoints\", function () {",
									"    pm.response.to.be.header('Content-Type', 'application/json');",
									"    var body = pm.response.json();",
									"    ",
									"    pm.expect(body).to.have.property(\"authorization_endpoint\");",
									"    pm.expect(body).to.have.property(\"token_endpoint\");",
									"    pm.expect(body).to.have.property(\"revocation_endpoint\");",
									"    pm.expect(body).to.have.property(\"userinfo_endpoint\");",
									"    pm.expect(body).to.have.property(\"registration_endpoint\");",
									"    pm.expect(body).to.have.property(\"registration_renew_secret_endpoint\");",
									"    pm.expect(body).to.have.property(\"authorization_signing_alg_values_supported\");",
									"    pm.expect(body).to.have.property(\"authorization_encryption_alg_values_supported\");",
									"    pm.expect(body).to.have.property(\"authorization_encryption_enc_values_supported\");",
									"    pm.expect(body).to.have.property(\"response_modes_supported\");",
									"    pm.expect(body.response_modes_supported).to.include('query.jwt')",
									"    ",
									"    pm.environment.set('authorizationEndpoint', body.authorization_endpoint);",
									"    pm.environment.set('tokenEndpoint', body.token_endpoint);",
									"    pm.environment.set('userinfoEndpoint', body.userinfo_endpoint);",
									"    pm.environment.set('revocationEndpoint', body.revocation_endpoint);",
									"    pm.environment.set('registrationEndpoint', body.registration_endpoint);",
									"    pm.environment.set('registrationRenewSecretEndpoint', body.registration_renew_secret_endpoint);",
									"    pm.environment.set('logoutEndpoint', body.end_session_endpoint);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{gateway_url}}/{{domainHrid}}/oidc/.well-known/openid-configuration",
							"host": [
								"{{gateway_url}}"
							],
							"path": [
								"{{domainHrid}}",
								"oidc",
								".well-known",
								"openid-configuration"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create client without DCR enabled",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var body = JSON.parse(responseBody);",
									"pm.environment.set('clientDCR', body.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"clientId\": \"dcr-client\",\n    \"clientSecret\": \"dcr-client-secret\",\n    \"name\": \"dcr-client-public-name\",\n    \"type\": \"WEB\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications"
							]
						}
					},
					"response": []
				},
				{
					"name": "Patch client - enable client credentials and DCR",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 6000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"settings\": { \n      \"oauth\": {\n          \"grantTypes\": [\"client_credentials\"],\n          \"responseTypes\": [],\n          \"applicationType\": \"server\",\n          \"scopeSettings\": [ {\"scope\" : \"dcr_admin\" }]\n        }\n    }\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/applications/{{clientDCR}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"applications",
								"{{clientDCR}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Case - Signing authorization",
			"item": [
				{
					"name": "Prepare Client",
					"item": [
						{
							"name": "Generate token - Case signing authorization",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});",
											"",
											"pm.test(\"Has an access_token\", function () {",
											"    var body = pm.response.json();",
											"    pm.expect(body).to.have.property('access_token');",
											"    pm.expect(body.scope).to.eql('dcr_admin');",
											"    ",
											"    pm.environment.set('access_token', body.access_token);",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Authorization",
										"value": "Basic ZGNyLWNsaWVudDpkY3ItY2xpZW50LXNlY3JldA=="
									}
								],
								"body": {
									"mode": "urlencoded",
									"urlencoded": [
										{
											"key": "grant_type",
											"value": "client_credentials",
											"type": "text"
										},
										{
											"key": "scope",
											"value": "dcr_admin",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{tokenEndpoint}}",
									"host": [
										"{{tokenEndpoint}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "Register client - rs256 authorization (default)",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.test(\"Status code is 201\", function () {",
											"    pm.response.to.have.status(201);",
											"});",
											"",
											"pm.test(\"Has default attributes\", function () {",
											"    var body = pm.response.json();",
											"    pm.expect(body.client_name).to.eql('client_rs256');",
											"",
											"    pm.expect(body).to.have.property('client_id');",
											"    pm.expect(body).to.have.property('client_secret');",
											"    pm.expect(body).to.have.property('authorization_signed_response_alg');",
											"    var credentials = body.client_id + \":\" + body.client_secret;",
											"    var authorization = CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(credentials));",
											"    pm.environment.set('dcrClientAuthorization', authorization);",
											"    ",
											"    pm.environment.set('newClientForDCRTests', body.id);",
											"    pm.environment.set('registrationAccessToken', body.registration_access_token);",
											"    pm.environment.set('registrationClientUri', body.registration_client_uri);",
											"    ",
											"    pm.environment.set('clientIdJarm', body.client_id);",
											"    pm.environment.set('clientSecretJarm', body.client_secret);",
											"});",
											"",
											"// wait for sync process",
											"setTimeout(function(){}, 6000);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/json"
									},
									{
										"key": "Authorization",
										"type": "text",
										"value": "Bearer {{access_token}}"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n\t\"client_name\":\"client_rs256\",\n    \"redirect_uris\": [\"https://op-test:60001/authz_cb\"],\n    \"application_type\": \"web\",\n    \"contacts\": [\"roland@example.com\"],\n    \"identityProviders\": [\n    \t{ \"identity\": \"{{idp.inmemory}}\", \"priority\" : -1 }\n\t],\n    \"response_types\": [\"code\",\"token\",\"id_token\",\"id_token token\"],\n    \"grant_types\": [\"authorization_code\",\"implicit\"],\n    \"scope\": \"openid\",\n    \"post_logout_redirect_uris\": [\"https://op-test:60001/logout\"],\n    \"token_endpoint_auth_method\": \"client_secret_basic\"\n}"
								},
								"url": {
									"raw": "{{registrationEndpoint}}",
									"host": [
										"{{registrationEndpoint}}"
									]
								}
							},
							"response": []
						}
					]
				},
				{
					"name": "Authorization Code Flow",
					"item": [
						{
							"name": "Nominal Case",
							"item": [
								{
									"name": "With state - Initiate the flow",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to login page\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Redirect to login page with client_id'] = location.includes(pm.environment.get('gateway_url') + '/' + domain + '/login') && location.includes('client_id=' + pm.environment.get('clientIdJarm'));",
													"    ",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{clientIdJarm}}&redirect_uri=https://op-test:60001/authz_cb&state=1234-5678-9876&response_mode=jwt&scope=openid",
											"host": [
												"{{authorizationEndpoint}}"
											],
											"query": [
												{
													"key": "response_type",
													"value": "code"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}"
												},
												{
													"key": "redirect_uri",
													"value": "https://op-test:60001/authz_cb"
												},
												{
													"key": "state",
													"value": "1234-5678-9876"
												},
												{
													"key": "response_mode",
													"value": "jwt"
												},
												{
													"key": "scope",
													"value": "openid"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "Redirect to login form",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Should be ok\", function () {",
													"    pm.response.to.be.ok;",
													"    ",
													"    // Extract the XSRF token to send it with the next request.",
													"    var responseHTML = cheerio.load(pm.response.text());",
													"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
													"    const action = responseHTML('form').attr('action');",
													"    pm.environment.set('xsrf', xsrfToken);",
													"    pm.environment.set('action', action);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{redirection}}",
											"host": [
												"{{redirection}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Post login form",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/x-www-form-urlencoded"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "X-XSRF-TOKEN",
													"value": "{{xsrf}}",
													"type": "text"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}",
													"type": "text"
												},
												{
													"key": "username",
													"value": "user",
													"type": "text"
												},
												{
													"key": "password",
													"value": "password",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{action}}",
											"host": [
												"{{action}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Follow redirection",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    ",
													"    pm.response.to.be.header('Content-Length', '0');",
													"    pm.response.to.have.header('Location');",
													"    pm.response.to.have.header('Set-Cookie');",
													"});",
													"",
													"pm.test(\"Should be redirected to consent page\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Redirect to login page with client_id'] = location.startsWith(pm.environment.get('gateway_url') + '/' + domain + '/oauth/consent');",
													"",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{redirection}}",
											"host": [
												"{{redirection}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Redirect to confirm access page",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Should be ok\", function () {",
													"    pm.response.to.be.ok;",
													"    ",
													"    // Extract the XSRF token to send it with the next request.",
													"    var responseHTML = cheerio.load(pm.response.text());",
													"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
													"    const action = responseHTML('form').attr('action');",
													"    pm.environment.set('xsrf', xsrfToken);",
													"    pm.environment.set('action', action);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{redirection}}",
											"host": [
												"{{redirection}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "Post authorize form",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"    ",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/x-www-form-urlencoded"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "X-XSRF-TOKEN",
													"value": "{{xsrf}}",
													"type": "text"
												},
												{
													"key": "scope.openid",
													"value": "true",
													"type": "text"
												},
												{
													"key": "user_oauth_approval",
													"value": "true",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{action}}",
											"host": [
												"{{action}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Follow redirection",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"function parseJwt (token) {",
													"    var base64Url = token.split('.')[1];",
													"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
													"    return JSON.parse(atob(base64));",
													"}",
													"",
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to redirect_uri with authorization_code\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    tests['Redirect to redirect_uri'] = location.includes('https://op-test:60001/authz_cb?');",
													"    tests['Contains a response'] = location.includes('response=');",
													"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
													"    tests['Do not contain an authorization_code'] = !location.includes('code=');",
													"    ",
													"    // Here we can extract the authorization_code to got further in the process",
													"    let response = location.substring(location.indexOf('response=') + 9);",
													"    ",
													"    let jwt = parseJwt(response);",
													"    let origin = pm.environment.get(\"gateway_url\");",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Contains a code claim'] = jwt.code !== undefined;",
													"    tests['Contains an iss claim'] = jwt.iss === origin + '/' + domain + '/oidc';",
													"    tests['Contains an aud claim'] = jwt.aud === pm.environment.get(\"clientIdJarm\");",
													"    tests['Contains an exp claim'] = jwt.exp !== undefined;",
													"    tests['Contains an state claim'] = jwt.state === '1234-5678-9876';",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{redirection}}",
											"host": [
												"{{redirection}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Logout user",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"    ",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{logoutEndpoint}}",
											"host": [
												"{{logoutEndpoint}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								}
							],
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							]
						},
						{
							"name": "Redirect URI mismatch",
							"item": [
								{
									"name": "With response.mode = jwt",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"function parseJwt (token) {",
													"    var base64Url = token.split('.')[1];",
													"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
													"    return JSON.parse(atob(base64));",
													"}",
													"",
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to login page\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    let origin = pm.environment.get(\"gateway_url\");",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Redirect to default error page'] = location.includes(origin + '/' + domain + '/oauth/error');",
													"    tests['Contains a response'] = location.includes('?response=');",
													"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
													"    ",
													"    // Here we can extract the authorization_code to got further in the process",
													"    let response = location.substring(location.indexOf('response=') + 9);",
													"    ",
													"    let jwt = parseJwt(response);",
													"    ",
													"    tests['Does not contain an authorization code claim'] = jwt.code === undefined;",
													"    tests['Contains an iss claim'] = jwt.iss === origin + '/' + domain + '/oidc';",
													"    tests['Contains an aud claim'] = jwt.aud === pm.environment.get(\"clientIdJarm\");",
													"    tests['Contains an exp claim'] = jwt.exp !== undefined;",
													"    tests['Contains an state claim'] = jwt.state === '1234-5678-9876';",
													"    tests['Contains an error'] = jwt.error === 'redirect_uri_mismatch';",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{clientIdJarm}}&redirect_uri=https://bad-uri:60001/authz_cb&state=1234-5678-9876&response_mode=jwt",
											"host": [
												"{{authorizationEndpoint}}"
											],
											"query": [
												{
													"key": "response_type",
													"value": "code"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}"
												},
												{
													"key": "redirect_uri",
													"value": "https://bad-uri:60001/authz_cb"
												},
												{
													"key": "state",
													"value": "1234-5678-9876"
												},
												{
													"key": "response_mode",
													"value": "jwt"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "With response.mode = fragment.jwt",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"function parseJwt (token) {",
													"    var base64Url = token.split('.')[1];",
													"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
													"    return JSON.parse(atob(base64));",
													"}",
													"",
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to login page\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    let origin = pm.environment.get(\"gateway_url\");",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Redirect to default error page'] = location.includes(origin + '/' + domain + '/oauth/error');",
													"    tests['Contains a response'] = location.includes('#response=');",
													"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
													"    ",
													"    // Here we can extract the authorization_code to got further in the process",
													"    let response = location.substring(location.indexOf('response=') + 9);",
													"    ",
													"    let jwt = parseJwt(response);",
													"    ",
													"    tests['Does not contain an authorization code claim'] = jwt.code === undefined;",
													"    tests['Contains an iss claim'] = jwt.iss === origin + '/' + domain + '/oidc';",
													"    tests['Contains an aud claim'] = jwt.aud === pm.environment.get(\"clientIdJarm\");",
													"    tests['Contains an exp claim'] = jwt.exp !== undefined;",
													"    tests['Contains an state claim'] = jwt.state === '1234-5678-9876';",
													"    tests['Contains an error'] = jwt.error === 'redirect_uri_mismatch';",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{clientIdJarm}}&redirect_uri=https://bad-uri:60001/authz_cb&state=1234-5678-9876&response_mode=fragment.jwt",
											"host": [
												"{{authorizationEndpoint}}"
											],
											"query": [
												{
													"key": "response_type",
													"value": "code"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}"
												},
												{
													"key": "redirect_uri",
													"value": "https://bad-uri:60001/authz_cb"
												},
												{
													"key": "state",
													"value": "1234-5678-9876"
												},
												{
													"key": "response_mode",
													"value": "fragment.jwt"
												}
											]
										}
									},
									"response": []
								}
							],
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							]
						}
					]
				},
				{
					"name": "Implicit Flow",
					"item": [
						{
							"name": "Nominal Case",
							"item": [
								{
									"name": "With state - Initiate the flow",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to login page\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Redirect to login page with client_id'] = location.includes(pm.environment.get('gateway_url') + '/' + domain + '/login') && location.includes('client_id=' + pm.environment.get('clientIdJarm'));",
													"    ",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{authorizationEndpoint}}?response_type=id_token token&client_id={{clientIdJarm}}&redirect_uri=https://op-test:60001/authz_cb&state=1234-5678-9876&response_mode=jwt&nonce=n-0S6_WzA2Mj",
											"host": [
												"{{authorizationEndpoint}}"
											],
											"query": [
												{
													"key": "response_type",
													"value": "id_token token"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}"
												},
												{
													"key": "redirect_uri",
													"value": "https://op-test:60001/authz_cb"
												},
												{
													"key": "state",
													"value": "1234-5678-9876"
												},
												{
													"key": "response_mode",
													"value": "jwt"
												},
												{
													"key": "nonce",
													"value": "n-0S6_WzA2Mj"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "Redirect to login form",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Should be ok\", function () {",
													"    pm.response.to.be.ok;",
													"    ",
													"    // Extract the XSRF token to send it with the next request.",
													"    var responseHTML = cheerio.load(pm.response.text());",
													"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
													"    const action = responseHTML('form').attr('action');",
													"    pm.environment.set('xsrf', xsrfToken);",
													"    pm.environment.set('action', action);",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{redirection}}",
											"host": [
												"{{redirection}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Post login form",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/x-www-form-urlencoded"
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "X-XSRF-TOKEN",
													"value": "{{xsrf}}",
													"type": "text"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}",
													"type": "text"
												},
												{
													"key": "username",
													"value": "user",
													"type": "text"
												},
												{
													"key": "password",
													"value": "password",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "{{action}}",
											"host": [
												"{{action}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Follow redirection",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"function parseJwt (token) {",
													"    var base64Url = token.split('.')[1];",
													"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
													"    return JSON.parse(atob(base64));",
													"}",
													"",
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to redirect_uri with authorization_code\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    tests['Redirect to redirect_uri'] = location.includes('https://op-test:60001/authz_cb#');",
													"    tests['Contains a response'] = location.includes('response=');",
													"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
													"    tests['Do not contain an authorization_code'] = !location.includes('code=');",
													"    ",
													"    // Here we can extract the authorization_code to got further in the process",
													"    let response = location.substring(location.indexOf('response=') + 9);",
													"    ",
													"    let jwt = parseJwt(response);",
													"    let origin = pm.environment.get(\"gateway_url\");",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Contains an access_token claim'] = jwt.access_token !== undefined;",
													"    tests['Contains an iss claim'] = jwt.iss === origin + '/' + domain + '/oidc';",
													"    tests['Contains an aud claim'] = jwt.aud === pm.environment.get(\"clientIdJarm\");",
													"    tests['Contains an exp claim'] = jwt.exp !== undefined;",
													"    tests['Contains an state claim'] = jwt.state === '1234-5678-9876';",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{redirection}}",
											"host": [
												"{{redirection}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								},
								{
									"name": "Logout user",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"    ",
													"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{logoutEndpoint}}",
											"host": [
												"{{logoutEndpoint}}"
											]
										},
										"description": "The client does not have a redirect_uri define"
									},
									"response": []
								}
							],
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							]
						},
						{
							"name": "Redirect URI mismatch",
							"item": [
								{
									"name": "With response.mode = jwt",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"function parseJwt (token) {",
													"    var base64Url = token.split('.')[1];",
													"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
													"    return JSON.parse(atob(base64));",
													"}",
													"",
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to login page\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    let origin = pm.environment.get(\"gateway_url\");",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Redirect to default error page'] = location.includes(origin + '/' + domain + '/oauth/error');",
													"    tests['Contains a response'] = location.includes('#response=');",
													"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
													"    ",
													"    // Here we can extract the authorization_code to got further in the process",
													"    let response = location.substring(location.indexOf('response=') + 9);",
													"    ",
													"    let jwt = parseJwt(response);",
													"    ",
													"    tests['Does not contain an authorization code claim'] = jwt.code === undefined;",
													"    tests['Contains an iss claim'] = jwt.iss === origin + '/' + domain + '/oidc';",
													"    tests['Contains an aud claim'] = jwt.aud === pm.environment.get(\"clientIdJarm\");",
													"    tests['Contains an exp claim'] = jwt.exp !== undefined;",
													"    tests['Contains an state claim'] = jwt.state === '1234-5678-9876';",
													"    tests['Contains an error'] = jwt.error === 'redirect_uri_mismatch';",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{authorizationEndpoint}}?response_type=id_token token&client_id={{clientIdJarm}}&redirect_uri=https://bad-uri:60001/authz_cb&state=1234-5678-9876&response_mode=jwt&nonce=n-0S6_WzA2Mj",
											"host": [
												"{{authorizationEndpoint}}"
											],
											"query": [
												{
													"key": "response_type",
													"value": "id_token token"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}"
												},
												{
													"key": "redirect_uri",
													"value": "https://bad-uri:60001/authz_cb"
												},
												{
													"key": "state",
													"value": "1234-5678-9876"
												},
												{
													"key": "response_mode",
													"value": "jwt"
												},
												{
													"key": "nonce",
													"value": "n-0S6_WzA2Mj"
												}
											]
										}
									},
									"response": []
								},
								{
									"name": "With response.mode = query.jwt",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"function parseJwt (token) {",
													"    var base64Url = token.split('.')[1];",
													"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
													"    return JSON.parse(atob(base64));",
													"}",
													"",
													"pm.test(\"Status code is 302\", function () {",
													"    pm.response.to.have.status(302);",
													"});",
													"",
													"pm.test(\"Should be redirected\", function () {",
													"    pm.response.to.be.redirection;",
													"    pm.response.to.have.header('Location');",
													"});",
													"",
													"pm.test(\"Should be a redirection to login page\", function() {",
													"    var location = postman.getResponseHeader('Location');",
													"    let origin = pm.environment.get(\"gateway_url\");",
													"    let domain = pm.environment.get(\"domainHrid\");",
													"    ",
													"    tests['Redirect to default error page'] = location.includes(origin + '/' + domain + '/oauth/error');",
													"    tests['Contains a response'] = location.includes('?response=');",
													"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
													"    ",
													"    // Here we can extract the authorization_code to got further in the process",
													"    let response = location.substring(location.indexOf('response=') + 9);",
													"    ",
													"    let jwt = parseJwt(response);",
													"    ",
													"    tests['Does not contain an authorization code claim'] = jwt.code === undefined;",
													"    tests['Contains an iss claim'] = jwt.iss === origin + '/' + domain + '/oidc';",
													"    tests['Contains an aud claim'] = jwt.aud === pm.environment.get(\"clientIdJarm\");",
													"    tests['Contains an exp claim'] = jwt.exp !== undefined;",
													"    tests['Contains an state claim'] = jwt.state === '1234-5678-9876';",
													"    tests['Contains an error'] = jwt.error === 'redirect_uri_mismatch';",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [],
										"url": {
											"raw": "{{authorizationEndpoint}}?response_type=id_token token&client_id={{clientIdJarm}}&redirect_uri=https://bad-uri:60001/authz_cb&state=1234-5678-9876&response_mode=query.jwt&nonce=n-0S6_WzA2Mj",
											"host": [
												"{{authorizationEndpoint}}"
											],
											"query": [
												{
													"key": "response_type",
													"value": "id_token token"
												},
												{
													"key": "client_id",
													"value": "{{clientIdJarm}}"
												},
												{
													"key": "redirect_uri",
													"value": "https://bad-uri:60001/authz_cb"
												},
												{
													"key": "state",
													"value": "1234-5678-9876"
												},
												{
													"key": "response_mode",
													"value": "query.jwt"
												},
												{
													"key": "nonce",
													"value": "n-0S6_WzA2Mj"
												}
											]
										}
									},
									"response": []
								}
							],
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							]
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					]
				}
			]
		},
		{
			"name": "Case - Encrypt authorization",
			"item": [
				{
					"name": "Case - RSA",
					"item": [
						{
							"name": "Prepare Client",
							"item": [
								{
									"name": "patch client - RSA-OAEP-256 - default",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.test(\"Status code is 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Get client with response types\", function () {",
													"    pm.response.to.be.header('Content-Type', 'application/json');",
													"    var body = pm.response.json();",
													"    pm.expect(body.authorization_encrypted_response_alg).to.eql('RSA-OAEP-256');",
													"    pm.expect(body.authorization_encrypted_response_enc).to.eql('A128CBC-HS256');",
													"});",
													"",
													"pm.test(\"One time Token\", function() {",
													"    var body = pm.response.json();",
													"    pm.expect(body).to.have.property('registration_access_token');",
													"    pm.expect(body.registration_access_token).to.not.eql(pm.environment.get('registrationAccessToken'));",
													"    pm.environment.set('registrationAccessToken', body.registration_access_token);",
													"    pm.environment.set('registrationClientUri', body.registration_client_uri);",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "PATCH",
										"header": [
											{
												"key": "Content-Type",
												"type": "text",
												"value": "application/json"
											},
											{
												"key": "Authorization",
												"type": "text",
												"value": "Bearer {{registrationAccessToken}}"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n   \"authorization_encrypted_response_alg\": \"RSA-OAEP-256\",\n   \"jwks\": {\n        \"keys\": [\n\t\t\t{  \n\t\t\t\t\"kty\": \"RSA\",\n\t\t\t\t\"use\": \"enc\",\n\t\t\t\t\"kid\": \"rsa-encryption-256\",\n\t\t\t\t\"e\": \"AQAB\",\n\t\t\t\t\"n\": \"lFAsvOm58TV5q9zyb3psQSESezZtYLZryGjq8LMnuqRt9cdPQCvMrnjcqdFWiXkD4ZXRO2Wp1iyzgprecx3dAnaD-KHlZR7vsFEmDh27DgNvEx5jKRSy5N2quI2LJw66Jb9JeMqoX6vtv_z3PRHb-zUhnIw6tBwZtuNE-AZSC6atr8ZCLXn6RPqJq_eoGgG-xaAzWPyRXDIqWPVO0RD3odjs6er7BcqVyHg54DyylrmRI4m6xERxpuNYI57bQN5_7a_3tR7hLeHJ8J1mNraMLH7H5_aAM_oSqKBEG9jHSTR7JsI3gSvsNOG-nP9jYxw7fH_c1XfRuTEJfBPEZxzD2Q\"\n\t\t\t},\n            {\n                \"kty\": \"RSA\",\n                \"use\": \"sig\",\n                \"kid\": \"rsa-signature\",\n                \"e\": \"AQAB\",\n                \"n\": \"pRXXMvbZC4-I8nmeirMmr_wlo-lpZo2cyfXLPSduieEsfLeO38vIFdXbVTQ-OAeihFrvbxHELt2mNwCH3gbosd0P-pyYtUOaGmi7rLW9Wik8JcNCKA-v7q2JWmBeRFyRAuwf343gnxNL1mpUHfhqd4eswRiO55iwFT8a8gmxSOm8VXjg2aeUjkI3diT84rGR-wK77OcXeF2zJzjRDe0yFla0Tjb1RNTNkVQBJAQ3VQOOaNL7bXajR79ERlMKCjRFIZ0QCB7Nf6LtMwp9QWRdFrm7RXIPpN1V03E4v51gq82URjuQvEANe-VGRVSBij_GcOSLGjyZQi-yGVyPjNVl1Q\"\n            },\n            {\n                \"kty\": \"EC\",\n                \"use\": \"sig\",\n                \"crv\": \"P-256\",\n                \"kid\": \"elliptic-curve-signature\",\n                \"x\": \"R4JmPwezbzLuyGkonWIkezzplUfed5b6F5PL4j0zdf8\",\n                \"y\": \"QQRGKwRV9jHSlHjUhOQ0FqdQEddFBPCHZXpoFjvGmcY\"\n            },\n\t\t\t{  \n\t\t\t\t\"kty\":\"EC\",\n\t\t\t\t\"use\":\"enc\",\n\t\t\t\t\"crv\":\"P-521\",\n                \"kid\": \"elliptic-curve-encryption\",\n\t\t\t\t\"x\":\"AfEFyeYAr1TwmvCxvqgWPEg4Vvf50RC2OdkYfTS30dInZwX-Ebn6elp4fQ0GOdOBbYRq9b2gQ79Cd1AytQhdF6To\",\n\t\t\t\t\"y\":\"Abj0w4nSumQWtO6AV7ufQN6VpmJoKlWmz9KB6BUU0ANcj4aTJjBE9WNiGCqFpvaIdEWZWcSsZNYGKT3rJ71AfLdm\"\n\t\t\t},\n\t\t\t{  \n\t\t\t\t\"kty\":\"OKP\",\n\t\t\t\t\"use\":\"enc\",\n\t\t\t\t\"kid\":\"edwards-curve-encryption\",\n\t\t\t\t\"crv\":\"X25519\",\n\t\t\t\t\"x\":\"vBNW8f19leF79U4U6NrDDQaK_i5kL0iMKghB39AUT2I\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"kty\": \"oct\",\n\t\t\t\t\"kid\": \"128bits\",\n\t\t\t\t\"k\" : \"p94TA_PhiVUdi_yxPbviAw\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"kty\": \"oct\",\n\t\t\t\t\"kid\": \"192bits\",\n\t\t\t\t\"k\" : \"G9jUYv3b0-0wZWCGxAnIUH6gI0kjeXj4\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"kty\": \"oct\",\n\t\t\t\t\"kid\": \"256bits\",\n\t\t\t\t\"k\" : \"pzx01XDfexcfxHWtk_MzjfCin5NMy3KBx2xtjrX1G-E\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"kty\": \"oct\",\n\t\t\t\t\"kid\": \"384bits\",\n\t\t\t\t\"k\" : \"MBNrGN8nwS7hlOVfqEy6qA98bzyo1BLGxr-kyN1E4UXYWQDkBg4L7AQRwpZdrKKS\"\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"kty\": \"oct\",\n\t\t\t\t\"kid\": \"512bits\",\n\t\t\t\t\"k\" : \"LfWisS5p-ohMbNbeWdiSapnHgA62XPu8DXzyzNZQHtQPglHf0Lb6NUM-8aQGj_YWErvODY5rQkpKeolrBKkcmg\"\n\t\t\t}\n        ]\n    }\n}"
										},
										"url": {
											"raw": "{{registrationClientUri}}",
											"host": [
												"{{registrationClientUri}}"
											]
										}
									},
									"response": []
								}
							]
						},
						{
							"name": "Authorization Code Flow",
							"item": [
								{
									"name": "Nominal Case",
									"item": [
										{
											"name": "With state - Initiate the flow",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 302\", function () {",
															"    pm.response.to.have.status(302);",
															"});",
															"",
															"pm.test(\"Should be redirected\", function () {",
															"    pm.response.to.be.redirection;",
															"    pm.response.to.have.header('Location');",
															"});",
															"",
															"pm.test(\"Should be a redirection to login page\", function() {",
															"    var location = postman.getResponseHeader('Location');",
															"    let domain = pm.environment.get(\"domainHrid\");",
															"    ",
															"    tests['Redirect to login page with client_id'] = location.includes(pm.environment.get('gateway_url') + '/' + domain + '/login') && location.includes('client_id=' + pm.environment.get('clientIdJarm'));",
															"    ",
															"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{clientIdJarm}}&redirect_uri=https://op-test:60001/authz_cb&state=1234-5678-9876&response_mode=jwt",
													"host": [
														"{{authorizationEndpoint}}"
													],
													"query": [
														{
															"key": "response_type",
															"value": "code"
														},
														{
															"key": "client_id",
															"value": "{{clientIdJarm}}"
														},
														{
															"key": "redirect_uri",
															"value": "https://op-test:60001/authz_cb"
														},
														{
															"key": "state",
															"value": "1234-5678-9876"
														},
														{
															"key": "response_mode",
															"value": "jwt"
														}
													]
												}
											},
											"response": []
										},
										{
											"name": "Redirect to login form",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 200\", function () {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Should be ok\", function () {",
															"    pm.response.to.be.ok;",
															"    ",
															"    // Extract the XSRF token to send it with the next request.",
															"    var responseHTML = cheerio.load(pm.response.text());",
															"    var xsrfToken = responseHTML('[name=\"X-XSRF-TOKEN\"]').val();",
															"    const action = responseHTML('form').attr('action');",
															"    pm.environment.set('xsrf', xsrfToken);",
															"    pm.environment.set('action', action);",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{redirection}}",
													"host": [
														"{{redirection}}"
													]
												},
												"description": "The client does not have a redirect_uri define"
											},
											"response": []
										},
										{
											"name": "Post login form",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 302\", function () {",
															"    pm.response.to.have.status(302);",
															"});",
															"",
															"pm.test(\"Should be redirected\", function () {",
															"    pm.response.to.be.redirection;",
															"    pm.response.to.have.header('Location');",
															"",
															"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "POST",
												"header": [
													{
														"key": "Content-Type",
														"value": "application/x-www-form-urlencoded"
													}
												],
												"body": {
													"mode": "urlencoded",
													"urlencoded": [
														{
															"key": "X-XSRF-TOKEN",
															"value": "{{xsrf}}",
															"type": "text"
														},
														{
															"key": "client_id",
															"value": "{{clientIdJarm}}",
															"type": "text"
														},
														{
															"key": "username",
															"value": "user",
															"type": "text"
														},
														{
															"key": "password",
															"value": "password",
															"type": "text"
														}
													]
												},
												"url": {
													"raw": "{{action}}",
													"host": [
														"{{action}}"
													]
												},
												"description": "The client does not have a redirect_uri define"
											},
											"response": []
										},
										{
											"name": "Follow redirection",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJweHeader (token) {",
															"    var base64Url = token.split('.')[0];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 302\", function () {",
															"    pm.response.to.have.status(302);",
															"});",
															"",
															"pm.test(\"Should be redirected\", function () {",
															"    pm.response.to.be.redirection;",
															"    pm.response.to.have.header('Location');",
															"});",
															"",
															"pm.test(\"Should be a redirection to redirect_uri with authorization_code\", function() {",
															"    var location = postman.getResponseHeader('Location');",
															"    tests['Redirect to redirect_uri'] = location.includes('https://op-test:60001/authz_cb?');",
															"    tests['Contains a response'] = location.includes('response=');",
															"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
															"    tests['Do not contain an authorization_code'] = !location.includes('code=');",
															"    ",
															"    // Here we can extract the authorization_code to got further in the process",
															"    let response = location.substring(location.indexOf('response=') + 9);",
															"    ",
															"    let header = parseJweHeader(response);",
															"    ",
															"    tests['Contains cty claim'] = header.cty === 'JWT';",
															"    tests['Contains alg claim'] = header.alg === 'RSA-OAEP-256';",
															"    tests['Contains enc claim'] = header.enc === 'A128CBC-HS256';",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{redirection}}",
													"host": [
														"{{redirection}}"
													]
												},
												"description": "The client does not have a redirect_uri define"
											},
											"response": []
										},
										{
											"name": "Logout user",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"pm.test(\"Status code is 302\", function () {",
															"    pm.response.to.have.status(302);",
															"});",
															"",
															"pm.test(\"Should be redirected\", function () {",
															"    pm.response.to.be.redirection;",
															"    pm.response.to.have.header('Location');",
															"    ",
															"    pm.environment.set('redirection', postman.getResponseHeader(\"Location\"));",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{logoutEndpoint}}",
													"host": [
														"{{logoutEndpoint}}"
													]
												},
												"description": "The client does not have a redirect_uri define"
											},
											"response": []
										}
									],
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													""
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													""
												]
											}
										}
									]
								},
								{
									"name": "Redirect URI mismatch",
									"item": [
										{
											"name": "With response.mode = jwt",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJweHeader (token) {",
															"    var base64Url = token.split('.')[0];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 302\", function () {",
															"    pm.response.to.have.status(302);",
															"});",
															"",
															"pm.test(\"Should be redirected\", function () {",
															"    pm.response.to.be.redirection;",
															"    pm.response.to.have.header('Location');",
															"});",
															"",
															"pm.test(\"Should be a redirection to login page\", function() {",
															"    var location = postman.getResponseHeader('Location');",
															"    let origin = pm.environment.get(\"gateway_url\");",
															"    let domain = pm.environment.get(\"domainHrid\");",
															"    ",
															"    tests['Redirect to default error page'] = location.includes(origin + '/' + domain + '/oauth/error');",
															"    tests['Contains a response'] = location.includes('?response=');",
															"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
															"    ",
															"    // Here we can extract the authorization_code to got further in the process",
															"    let response = location.substring(location.indexOf('response=') + 9);",
															"    ",
															"    let header = parseJweHeader(response);",
															"    ",
															"    tests['Contains cty claim'] = header.cty === 'JWT';",
															"    tests['Contains alg claim'] = header.alg === 'RSA-OAEP-256';",
															"    tests['Contains enc claim'] = header.enc === 'A128CBC-HS256';",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{clientIdJarm}}&redirect_uri=https://bad-uri:60001/authz_cb&state=1234-5678-9876&response_mode=jwt",
													"host": [
														"{{authorizationEndpoint}}"
													],
													"query": [
														{
															"key": "response_type",
															"value": "code"
														},
														{
															"key": "client_id",
															"value": "{{clientIdJarm}}"
														},
														{
															"key": "redirect_uri",
															"value": "https://bad-uri:60001/authz_cb"
														},
														{
															"key": "state",
															"value": "1234-5678-9876"
														},
														{
															"key": "response_mode",
															"value": "jwt"
														}
													]
												}
											},
											"response": []
										},
										{
											"name": "With response.mode = fragment.jwt",
											"event": [
												{
													"listen": "test",
													"script": {
														"exec": [
															"function parseJweHeader (token) {",
															"    var base64Url = token.split('.')[0];",
															"    var base64 = base64Url.replace('-', '+').replace('_', '/');",
															"    return JSON.parse(atob(base64));",
															"}",
															"",
															"pm.test(\"Status code is 302\", function () {",
															"    pm.response.to.have.status(302);",
															"});",
															"",
															"pm.test(\"Should be redirected\", function () {",
															"    pm.response.to.be.redirection;",
															"    pm.response.to.have.header('Location');",
															"});",
															"",
															"pm.test(\"Should be a redirection to login page\", function() {",
															"    var location = postman.getResponseHeader('Location');",
															"    let origin = pm.environment.get(\"gateway_url\");",
															"    let domain = pm.environment.get(\"domainHrid\");",
															"    ",
															"    tests['Redirect to default error page'] = location.includes(origin + '/' + domain + '/oauth/error');",
															"    tests['Contains a response'] = location.includes('#response=');",
															"    tests['Do not contain the initial state'] = !location.includes('state=1234-5678-9876');",
															"    ",
															"    // Here we can extract the authorization_code to got further in the process",
															"    let response = location.substring(location.indexOf('response=') + 9);",
															"    ",
															"    let header = parseJweHeader(response);",
															"    ",
															"    tests['Contains cty claim'] = header.cty === 'JWT';",
															"    tests['Contains alg claim'] = header.alg === 'RSA-OAEP-256';",
															"    tests['Contains enc claim'] = header.enc === 'A128CBC-HS256';",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{authorizationEndpoint}}?response_type=code&client_id={{clientIdJarm}}&redirect_uri=https://bad-uri:60001/authz_cb&state=1234-5678-9876&response_mode=fragment.jwt",
													"host": [
														"{{authorizationEndpoint}}"
													],
													"query": [
														{
															"key": "response_type",
															"value": "code"
														},
														{
															"key": "client_id",
															"value": "{{clientIdJarm}}"
														},
														{
															"key": "redirect_uri",
															"value": "https://bad-uri:60001/authz_cb"
														},
														{
															"key": "state",
															"value": "1234-5678-9876"
														},
														{
															"key": "response_mode",
															"value": "fragment.jwt"
														}
													]
												}
											},
											"response": []
										}
									],
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"type": "text/javascript",
												"exec": [
													""
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"type": "text/javascript",
												"exec": [
													""
												]
											}
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "Delete domain",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {",
							"    pm.response.to.have.status(204);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
					"host": [
						"{{management_url}}"
					],
					"path": [
						"management",
						"organizations",
						"{{defaultOrganizationId}}",
						"environments",
						"{{defaultEnvironmentId}}",
						"domains",
						"{{domain}}"
					]
				}
			},
			"response": []
		}
	]
}
