{
	"info": {
		"_postman_id": "163296ee-b1c2-4bb9-b2cc-fb3e05f5d593",
		"name": "Gravitee.io - AM - Openid Discovery",
		"description": "Test openid connect discovery specifications: https://openid.net/specs/openid-connect-discovery-1_0.html",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Prepare",
			"item": [
				{
					"name": "Generate admin token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var token = JSON.parse(responseBody);",
									"pm.environment.set('token', token.access_token);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Basic YWRtaW46YWRtaW5hZG1pbg=="
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password",
									"type": "text"
								},
								{
									"key": "username",
									"value": "admin",
									"type": "text"
								},
								{
									"key": "password",
									"value": "adminadmin",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{management_url}}/management/auth/token",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"auth",
								"token"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create oidc-discovery domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"pm.environment.set('domain', jsonData.id);",
									"pm.environment.set('domainHrid', jsonData.hrid);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"name\": \"oidc-discovery\", \n\t\"description\": \"test openid connect discovery specifications\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								""
							]
						}
					},
					"response": []
				},
				{
					"name": "Create jks certificate rs512",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Extension Grant - create jks certificate\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('id');",
									"    pm.environment.set('certificateJksRs512', jsonData.id);",
									"});",
									"",
									"// wait for sync process",
									"setTimeout(function(){}, 1000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"type": "text",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"type\": \"javakeystore-am-certificate\",\n  \"configuration\": \"{\\\"jks\\\":\\\"{\\\\\\\"name\\\\\\\":\\\\\\\"server.jks\\\\\\\",\\\\\\\"type\\\\\\\":\\\\\\\"\\\\\\\",\\\\\\\"size\\\\\\\":2237,\\\\\\\"content\\\\\\\":\\\\\\\"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\\\\\\\"}\\\",\\\"storepass\\\":\\\"changeme\\\",\\\"alias\\\":\\\"mytestkey\\\",\\\"keypass\\\":\\\"letmein\\\"}\",\n  \"name\": \"Test\"\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}/certificates",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}",
								"certificates"
							]
						}
					},
					"response": []
				},
				{
					"name": "Start domain",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// wait for sync process",
									"setTimeout(function(){}, 10000);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"enabled\": true\n}"
						},
						"url": {
							"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
							"host": [
								"{{management_url}}"
							],
							"path": [
								"management",
								"organizations",
								"{{defaultOrganizationId}}",
								"environments",
								"{{defaultEnvironmentId}}",
								"domains",
								"{{domain}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Delete domain",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 204\", function () {",
							"    pm.response.to.have.status(204);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{token}}"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "{{management_url}}/management/organizations/{{defaultOrganizationId}}/environments/{{defaultEnvironmentId}}/domains/{{domain}}",
					"host": [
						"{{management_url}}"
					],
					"path": [
						"management",
						"organizations",
						"{{defaultOrganizationId}}",
						"environments",
						"{{defaultEnvironmentId}}",
						"domains",
						"{{domain}}"
					]
				}
			},
			"response": []
		}
	]
}
